import{e as p,z as le,o as k,w as i,a as l,l as oe,m as q,ab as ne,ac as ae,ad as ie,q as y,i as se,c as E,y as z,g as e,p as M,k as H,R as x,s as S,t as D,U as de,V as re,W as ue,X as ce,Y as ve,_ as fe,L as me}from"./vue-core-ejNiufTe.js";import{_ as $,e as pe,c as be,d as ye,g as A,f as j}from"./index-C-2LZmHF.js";const ge=(a,f,s)=>{if(f==null||f===""){s(new Error("ID不能为空"));return}const u=Number(f);if(isNaN(u)){s(new Error("ID必须是有效的数字"));return}if(!Number.isInteger(u)){s(new Error("ID必须是整数"));return}if(u<=0){s(new Error("ID必须是正整数"));return}s()},F={__name:"DeviceForm",props:{deviceInfo:{type:Object,default:()=>({})}},setup(a,{expose:f}){const s=p(null),u={deviceId:[{required:!0,message:"请输入设备ID",trigger:"blur"},{validator:ge,message:"设备ID必须是数字",trigger:"blur"}],deviceName:[{required:!0,message:"请输入设备名称",trigger:"blur"},{min:3,max:10,message:"设备名称长度必须在3到10之间",trigger:"blur"}],deviceModel:[{required:!0,message:"请输入设备型号",trigger:"blur"},{min:1,max:10,message:"设备型号长度必须在1到10之间",trigger:"blur"}],manufacturer:[{required:!0,message:"请输入制造商",trigger:"blur"},{min:3,max:15,message:"制造商长度必须在3到15之间",trigger:"blur"}],productionPlace:[{required:!0,message:"请输入产地",trigger:"blur"},{min:3,max:15,message:"产地长度必须在3到15之间",trigger:"blur"}]};return f({formRef:s}),(b,t)=>{const c=q,r=oe,v=ne,_=ie,h=ae,C=se;return k(),le(C,{ref_key:"formRef",ref:s,model:a.deviceInfo,rules:u},{default:i(()=>[l(r,{label:"设备ID",prop:"deviceId"},{default:i(()=>[l(c,{modelValue:a.deviceInfo.deviceId,"onUpdate:modelValue":t[0]||(t[0]=m=>a.deviceInfo.deviceId=m),placeholder:"请输入设备ID"},null,8,["modelValue"])]),_:1}),l(r,{label:"设备名称",prop:"deviceName"},{default:i(()=>[l(c,{modelValue:a.deviceInfo.deviceName,"onUpdate:modelValue":t[1]||(t[1]=m=>a.deviceInfo.deviceName=m),placeholder:"请输入设备名称"},null,8,["modelValue"])]),_:1}),l(r,{label:"设备型号",prop:"deviceModel"},{default:i(()=>[l(c,{modelValue:a.deviceInfo.deviceModel,"onUpdate:modelValue":t[2]||(t[2]=m=>a.deviceInfo.deviceModel=m),placeholder:"请输入设备型号"},null,8,["modelValue"])]),_:1}),l(r,{label:"生产日期",prop:"manufactureDate"},{default:i(()=>[l(v,{modelValue:a.deviceInfo.manufactureDate,"onUpdate:modelValue":t[3]||(t[3]=m=>a.deviceInfo.manufactureDate=m),type:"datetime",placeholder:"请选择生产日期",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),l(r,{label:"送检日期",prop:"inspectionDate"},{default:i(()=>[l(v,{modelValue:a.deviceInfo.inspectionDate,"onUpdate:modelValue":t[4]||(t[4]=m=>a.deviceInfo.inspectionDate=m),type:"datetime",placeholder:"请选择送检日期",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),l(r,{label:"制造商",prop:"manufacturer"},{default:i(()=>[l(c,{modelValue:a.deviceInfo.manufacturer,"onUpdate:modelValue":t[5]||(t[5]=m=>a.deviceInfo.manufacturer=m),placeholder:"请输入制造商"},null,8,["modelValue"])]),_:1}),l(r,{label:"产地",prop:"productionPlace"},{default:i(()=>[l(c,{modelValue:a.deviceInfo.productionPlace,"onUpdate:modelValue":t[6]||(t[6]=m=>a.deviceInfo.productionPlace=m),placeholder:"请输入产地"},null,8,["modelValue"])]),_:1}),l(r,{label:"设备状态",prop:"deviceStatus"},{default:i(()=>[l(h,{modelValue:a.deviceInfo.deviceStatus,"onUpdate:modelValue":t[7]||(t[7]=m=>a.deviceInfo.deviceStatus=m)},{default:i(()=>[l(_,{label:"已检测"},{default:i(()=>t[8]||(t[8]=[y(" 已检测 ")])),_:1}),l(_,{label:"未检测"},{default:i(()=>t[9]||(t[9]=[y(" 未检测 ")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])}}},Ie={class:"modal"},De={class:"modal-content"},_e={class:"modal-footer"},we={__name:"EditDevice",props:{deviceInfo:{type:Object,default:()=>({})},isEditVisible:{type:Boolean,default:!1}},emits:["close","refresh"],setup(a,{emit:f}){const s=a,u=f,d=()=>{u("close")},b=p(null),t=async()=>{b.value.formRef.validate(async c=>{if(c){if(s.deviceInfo.id){s.deviceInfo.manufactureDate&&(s.deviceInfo.manufactureDate=x(s.deviceInfo.manufactureDate,"yyyy-MM-dd HH:mm:ss")),s.deviceInfo.inspectionDate&&(s.deviceInfo.inspectionDate=x(s.deviceInfo.inspectionDate,"yyyy-MM-dd HH:mm:ss"));try{await pe(s.deviceInfo),u("close"),u("refresh")}catch(r){console.error("编辑设备信息失败",r)}}}else return S.error("表单验证不通过，请检查输入信息"),!1})};return(c,r)=>{const v=M;return a.isEditVisible?(k(),E("div",{key:0,class:"modal-overlay",style:{"z-index":"99"},onClick:H(d,["self"])},[e("div",Ie,[e("div",{class:"modal-header"},[r[0]||(r[0]=e("span",null,"编辑设备信息",-1)),e("button",{onClick:d},"×")]),e("div",De,[l(F,{ref_key:"formRef",ref:b,"device-info":a.deviceInfo},null,8,["device-info"])]),e("div",_e,[l(v,{type:"primary",onClick:t},{default:i(()=>r[1]||(r[1]=[y(" 保存 ")])),_:1}),l(v,{onClick:d},{default:i(()=>r[2]||(r[2]=[y(" 取消 ")])),_:1})])])])):z("",!0)}}},Ve=$(we,[["__scopeId","data-v-7c9175bb"]]),xe={class:"modal"},Ce={class:"modal-content"},ke={class:"form-item"},he={class:"form-item"},Ee={class:"form-item"},Me={class:"form-item"},$e={class:"form-item"},Ne={class:"form-item"},Re={class:"form-item"},Be={class:"form-item"},Se={class:"modal-footer"},ze={__name:"ViewDevice",props:{deviceInfo:{type:Object,default:()=>({})},isViewVisible:{type:Boolean,default:!1}},emits:["close"],setup(a,{emit:f}){const s=f,u=()=>{s("close")},d=b=>b?x(new Date(b),"yyyy-MM-dd HH:mm:ss"):"";return(b,t)=>{const c=M;return a.isViewVisible?(k(),E("div",{key:0,class:"modal-overlay",style:{"z-index":"99"},onClick:H(u,["self"])},[e("div",xe,[e("div",{class:"modal-header"},[t[0]||(t[0]=e("span",null,"查看详情",-1)),e("button",{onClick:u},"×")]),e("div",Ce,[e("div",ke,[t[1]||(t[1]=e("label",null,"设备ID:",-1)),e("span",null,D(a.deviceInfo.deviceId),1)]),e("div",he,[t[2]||(t[2]=e("label",null,"设备名称:",-1)),e("span",null,D(a.deviceInfo.deviceName),1)]),e("div",Ee,[t[3]||(t[3]=e("label",null,"设备型号:",-1)),e("span",null,D(a.deviceInfo.deviceModel),1)]),e("div",Me,[t[4]||(t[4]=e("label",null,"制造商:",-1)),e("span",null,D(a.deviceInfo.manufacturer),1)]),e("div",$e,[t[5]||(t[5]=e("label",null,"产地:",-1)),e("span",null,D(a.deviceInfo.productionPlace),1)]),e("div",Ne,[t[6]||(t[6]=e("label",null,"生产日期:",-1)),e("span",null,D(d(a.deviceInfo.manufactureDate)),1)]),e("div",Re,[t[7]||(t[7]=e("label",null,"送检日期:",-1)),e("span",null,D(d(a.deviceInfo.inspectionDate)),1)]),e("div",Be,[t[8]||(t[8]=e("label",null,"设备状态:",-1)),e("span",null,D(a.deviceInfo.deviceStatus),1)])]),e("div",Se,[l(c,{onClick:u},{default:i(()=>t[9]||(t[9]=[y(" 关闭 ")])),_:1})])])])):z("",!0)}}},He=$(ze,[["__scopeId","data-v-477c83c5"]]),Pe={class:"modal"},Ue={class:"modal-content"},Ae={class:"modal-footer"},je={__name:"AddDevice",props:{isAddVisible:{type:Boolean,default:!1}},emits:["close","refresh"],setup(a,{emit:f}){const s=f,u=()=>{s("close")},d=p({deviceId:"",deviceName:"",deviceModel:"",manufactureDate:null,inspectionDate:null,manufacturer:"",productionPlace:"",deviceStatus:""}),b=p(null),t=async()=>{b.value.formRef.validate(async r=>{if(r){d.value.manufactureDate&&d.value.inspectionDate&&(d.value.manufactureDate=x(d.value.manufactureDate,"yyyy-MM-dd HH:mm:ss"),d.value.inspectionDate=x(d.value.inspectionDate,"yyyy-MM-dd HH:mm:ss"));try{const v=await be(d.value.deviceId);if(console.log(v.exist),v.exist!==0){S.error("该设备编号已存在，请重新输入设备编号");return}await ye(d.value),u(),s("refresh"),c()}catch(v){console.error("保存设备信息失败",v)}}else return S.error("表单验证不通过，请检查输入信息"),!1})},c=()=>{d.value={deviceId:"",deviceName:"",deviceModel:"",manufactureDate:null,inspectionDate:null,manufacturer:"",productionPlace:"",deviceStatus:""},b.value.formRef.resetFields()};return(r,v)=>{const _=M;return a.isAddVisible?(k(),E("div",{key:0,class:"modal-overlay",style:{"z-index":"99"},onClick:H(u,["self"])},[e("div",Pe,[e("div",{class:"modal-header"},[v[0]||(v[0]=e("span",null,"添加设备",-1)),e("button",{onClick:u},"×")]),e("div",Ue,[l(F,{ref_key:"formRef",ref:b,"device-info":d.value},null,8,["device-info"])]),e("div",Ae,[l(_,{type:"primary",onClick:t},{default:i(()=>v[1]||(v[1]=[y(" 保存 ")])),_:1}),l(_,{onClick:c},{default:i(()=>v[2]||(v[2]=[y(" 重置 ")])),_:1})])])])):z("",!0)}}},qe=$(je,[["__scopeId","data-v-da1111fc"]]),Fe={class:"list-container"},Le={class:"upper-section"},Te={class:"search-filter"},Ke={class:"action-buttons"},Oe={class:"lower-section"},Ge=["onClick"],We=["onClick"],Xe=["onClick"],Ye={class:"pagination-wrapper"},Je={__name:"DeviceList",setup(a){const f=p([]),s=p(""),u=p(1),d=p(5),b=p(0),t=p([]),c=p(!1),r=p(!1),v=p({}),_=p(!1),h=p({}),C=p(!1),m=o=>o?x(new Date(o),"yyyy-MM-dd"):"",w=async()=>{try{const o=await A();b.value=o.length;const n=(u.value-1)*d.value,V=n+d.value;f.value=o.slice(n,V)}catch(o){console.error("获取设备列表失败",o)}},L=()=>{r.value=!0},T=o=>{v.value={...o},_.value=!0,w()},K=o=>{h.value={...o},C.value=!0},O=o=>{t.value=o,c.value=o.length>0&&o.length<f.value.length,o.length===f.value.length&&(c.value=!1)},G=o=>{o.length===f.value.length?c.value=!1:o.length>0?c.value=!0:c.value=!1,t.value=o},W=()=>!0,P=async()=>{try{const n=(await A()).filter(R=>R.deviceName.includes(s.value));b.value=n.length,u.value=1;const V=0,N=d.value;f.value=n.slice(V,N)}catch(o){console.error("搜索设备信息失败",o)}},X=async()=>{try{const o=t.value.map(n=>n.id);for(const n of o)await j(n);await w()}catch(o){console.error("批量删除设备信息失败",o)}},Y=async o=>{try{await j(o),await w()}catch(n){console.error("删除设备信息失败",n)}},J=o=>{me.confirm("请问您是否要删除该设备信息信息?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Y(o.id)}).catch(()=>{})},Q=o=>{console.log("新的每页数量:",o),d.value=o,w()},Z=o=>{console.log("新的页码:",o),u.value=o,w()};return w(),(o,n)=>{const V=ve,N=re,R=q,B=M,I=fe,ee=ue,te=ce;return k(),E("div",Fe,[l(N,{separator:"/",class:"breadcrumb"},{default:i(()=>[l(V,null,{default:i(()=>n[4]||(n[4]=[y("首页")])),_:1}),l(V,null,{default:i(()=>n[5]||(n[5]=[y("设备管理")])),_:1})]),_:1}),e("div",Le,[e("div",Te,[l(R,{modelValue:s.value,"onUpdate:modelValue":n[0]||(n[0]=g=>s.value=g),placeholder:"请输入设备名称",style:{width:"250px",margin:"10px 0"},onKeyup:de(P,["enter"])},null,8,["modelValue"]),l(B,{type:"primary",onClick:P},{default:i(()=>n[6]||(n[6]=[y(" 搜索 ")])),_:1})]),e("div",Ke,[l(B,{type:"danger",onClick:X},{default:i(()=>n[7]||(n[7]=[y(" 批量删除 ")])),_:1}),l(B,{type:"warning",onClick:L},{default:i(()=>n[8]||(n[8]=[y(" 添加设备 ")])),_:1})])]),n[11]||(n[11]=e("br",null,null,-1)),e("div",Oe,[l(ee,{data:f.value,border:"",style:{width:"100%","margin-top":"20px"},"cell-style":{textAlign:"center"},"header-cell-style":{textAlign:"center"},onSelectionChange:O},{default:i(()=>[l(I,{type:"selection",width:"50",indeterminate:c.value,selectable:W,onSelectAll:G},null,8,["indeterminate"]),l(I,{prop:"deviceId",label:"设备ID",width:"100"}),l(I,{prop:"deviceName",label:"设备名称",width:"100"}),l(I,{prop:"deviceModel",label:"设备型号",width:"100"}),l(I,{prop:"manufactureDate",label:"生产日期",width:"200"},{default:i(g=>[y(D(m(g.row.manufactureDate)),1)]),_:1}),l(I,{prop:"inspectionDate",label:"送检日期",width:"200"},{default:i(g=>[y(D(m(g.row.inspectionDate)),1)]),_:1}),l(I,{prop:"manufacturer",label:"制造商",width:"140"}),l(I,{prop:"productionPlace",label:"产地",width:"140"}),l(I,{prop:"deviceStatus",label:"设备状态",width:"100"}),l(I,{label:"操作",fixed:"right","min-width":"200"},{default:i(g=>[e("a",{href:"javascript:void(0)",onClick:U=>T(g.row)},"编辑",8,Ge),n[9]||(n[9]=e("span",{class:"divider"},"|",-1)),e("a",{href:"javascript:void(0)",onClick:U=>K(g.row)},"查看详情",8,We),n[10]||(n[10]=e("span",{class:"divider"},"|",-1)),e("a",{href:"javascript:void(0)",onClick:U=>J(g.row)},"删除",8,Xe)]),_:1})]),_:1},8,["data"]),e("div",Ye,[l(te,{"current-page":u.value,"page-sizes":[5,10,15],"page-size":d.value,layout:"total, prev, pager, next, sizes, jumper",total:b.value,onSizeChange:Q,onCurrentChange:Z},null,8,["current-page","page-size","total"])])]),l(Ve,{"device-info":v.value,"is-edit-visible":_.value,onClose:n[1]||(n[1]=g=>_.value=!1),onRefresh:w},null,8,["device-info","is-edit-visible"]),l(He,{"device-info":h.value,"is-view-visible":C.value,onClose:n[2]||(n[2]=g=>C.value=!1)},null,8,["device-info","is-view-visible"]),l(qe,{"is-add-visible":r.value,onClose:n[3]||(n[3]=g=>r.value=!1),onRefresh:w},null,8,["is-add-visible"])])}}},et=$(Je,[["__scopeId","data-v-6aeeb076"]]);export{et as default};
