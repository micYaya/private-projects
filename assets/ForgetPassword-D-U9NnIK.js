import{u as x,c as B,e as k,f as F,h as q}from"./vue-core-C5ihzaHo.js";import{ref as v,computed as U,onBeforeUnmount as I,createElementBlock as P,openBlock as $,Fragment as R,createElementVNode as p,createVNode as l,withModifiers as T,withCtx as s,createTextVNode as f,toDisplayString as M}from"vue";import{r as N,a as S}from"./index-BKSytqbL.js";import{ElMessageBox as D,ElMessage as w}from"element-plus";const z={class:"wrapper"},A={class:"reset-form"},K={__name:"ForgetPassword",setup(L){const c=x(),m=v(null),r=v({username:"",phone:"",verifyCode:"",password1:"",password2:""}),b={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:4,max:15,message:"用户名长度需在4到15个字符",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1\d{10}$/,message:"手机号格式不正确",trigger:"blur"}],verifyCode:[{required:!0,message:"请输入验证码",trigger:"blur"},{pattern:/^\d{4}$/,message:"验证码需为4位数字",trigger:"blur"}],password1:[{required:!0,message:"请输入密码",trigger:"blur"},{pattern:/^[A-Za-z\d]{6,10}$/,message:"密码需6-10位字母或数字",trigger:"blur"}],password2:[{required:!0,message:"请再次确定密码",trigger:"blur"},{validator:(a,e,o)=>{e!==r.value.password1?o(new Error("两次输入的密码不一致")):o()},trigger:"blur"}]},u=v(60);let i=null;const V=U(()=>/^1\d{10}$/.test(r.value.phone)),_=()=>{u.value=60,i=setInterval(()=>{u.value--,u.value<=0&&g()},1e3)},g=()=>{clearInterval(i),u.value=0,i=null};I(()=>{i&&g()});const C=async()=>{try{await m.value.validateField("phone"),_();const a=await S(r.value.phone);a.code!==0&&(w.warning(a.msg),g())}catch(a){console.log("获取密码失败：",a)}},y=async()=>{try{if(!await m.value.validate())return;const{phone:e,verifyCode:o,password1:n}=r.value,d=await N(e,o,n);d.code===0?(await D.alert("密码重置成功，将返回登录页面","成功",{type:"success",confirmButtonText:"确定"}),c.push("/login")):w.warning(d.msg)}catch(a){console.error("密码重置失败:",a),w.error("操作失败，请检查输入信息")}},h=()=>{c.push("/login")};return(a,e)=>{const o=F,n=k,d=q,E=B;return $(),P(R,null,[e[8]||(e[8]=p("div",{class:"header"},[p("p",null,"互感器二次压降检测仪检定系统")],-1)),p("div",z,[e[7]||(e[7]=p("h1",null,"▎重置密码",-1)),p("div",A,[l(E,{ref_key:"FormRef",ref:m,model:r.value,rules:b,onSubmit:T(y,["prevent"])},{default:s(()=>[l(n,{label:"登录账号：",prop:"username"},{default:s(()=>[l(o,{modelValue:r.value.username,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value.username=t),placeholder:"请输入账号"},null,8,["modelValue"])]),_:1}),l(n,{label:"手机号码：",prop:"phone"},{default:s(()=>[l(o,{modelValue:r.value.phone,"onUpdate:modelValue":e[1]||(e[1]=t=>r.value.phone=t),placeholder:"请输入手机号码"},null,8,["modelValue"])]),_:1}),l(n,{label:"验证码：",prop:"verifyCode"},{default:s(()=>[l(o,{modelValue:r.value.verifyCode,"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.verifyCode=t),placeholder:"请输入验证码",style:{flex:"1"}},null,8,["modelValue"]),l(d,{disabled:!V.value,type:"primary",style:{right:"0"},onClick:C},{default:s(()=>[f(M(u.value<60?`${u.value}秒后重试`:"获取验证码"),1)]),_:1},8,["disabled"])]),_:1}),l(n,{label:"新密码：",prop:"password1"},{default:s(()=>[l(o,{modelValue:r.value.password1,"onUpdate:modelValue":e[3]||(e[3]=t=>r.value.password1=t),type:"password","show-password":"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),l(n,{label:"密码二次确认：",prop:"password2"},{default:s(()=>[l(o,{modelValue:r.value.password2,"onUpdate:modelValue":e[4]||(e[4]=t=>r.value.password2=t),type:"password","show-password":"",placeholder:"请再次确认密码"},null,8,["modelValue"])]),_:1}),l(d,{type:"primary",class:"backBtn",onClick:h},{default:s(()=>e[5]||(e[5]=[f(" 返回登录页面 ")])),_:1}),l(d,{type:"primary",class:"resetBtn",onClick:y},{default:s(()=>e[6]||(e[6]=[f(" 确定重置密码 ")])),_:1})]),_:1},8,["model"])])])],64)}}};export{K as default};
