import{f as N,h as z,B as se,C as ie,i as de,u as ue,v as re,w as me,y as ve,z as pe,A as fe}from"./vue-core-C2r4m7CJ.js";import{createElementBlock as A,createCommentVNode as S,openBlock as B,withModifiers as F,createElementVNode as e,createVNode as t,withCtx as p,createTextVNode as V,toDisplayString as k,ref as m,computed as ce,onMounted as be,withKeys as ge}from"vue";import{_ as P,l as _e,m as Ie,n as K,o as O}from"./index-DjiLuGwl.js";import{ElMessage as T,ElMessageBox as Ve}from"element-plus";const ye={class:"modal"},we={class:"modal-content"},ke={class:"form-item"},Ce={class:"form-item"},$e={class:"form-item"},Ue={class:"form-item"},xe={class:"form-item"},je={class:"form-item"},Ee={class:"form-item"},Te={class:"modal-footer"},he={__name:"EditItem",props:{itemInfo:{type:Object,default:()=>({})},isEditVisible:{type:Boolean,default:!1}},emits:["close","refresh"],setup(i,{emit:u}){const I=i,f=u,g=()=>{f("close")},l=()=>{const{project:b,gear:a,percentage:c,data_lower_limit:y,data_upper_limit:d,measured_data:w,task_id:n}=I.itemInfo;return!b||!a||c===null||y===null||d===null||w===null||!n?(T.error("所有输入数据都不能为空"),!1):c<=0||y<=0||d<=0||w<=0?(T.error("所有百分比、数据下限、数据上限和实测数据必须大于 0"),!1):!0},_=async()=>{if(l()&&I.itemInfo.item_id)try{await _e(I.itemInfo.item_id,I.itemInfo),f("close"),f("refresh")}catch(b){console.error("编辑检测项目信息失败",b)}};return(b,a)=>{const c=N,y=z;return i.isEditVisible?(B(),A("div",{key:0,class:"modal-overlay",style:{"z-index":"99"},onClick:F(g,["self"])},[e("div",ye,[e("div",{class:"modal-header"},[a[7]||(a[7]=e("span",null,"编辑检测项目信息",-1)),e("button",{onClick:g},"×")]),e("div",we,[e("form",null,[e("div",ke,[a[8]||(a[8]=e("label",null,"*项目",-1)),t(c,{modelValue:i.itemInfo.project,"onUpdate:modelValue":a[0]||(a[0]=d=>i.itemInfo.project=d),placeholder:"请输入项目"},null,8,["modelValue"])]),e("div",Ce,[a[9]||(a[9]=e("label",null,"档位",-1)),t(c,{modelValue:i.itemInfo.gear,"onUpdate:modelValue":a[1]||(a[1]=d=>i.itemInfo.gear=d),placeholder:"请输入档位"},null,8,["modelValue"])]),e("div",$e,[a[10]||(a[10]=e("label",null,"*百分比(%)",-1)),t(c,{modelValue:i.itemInfo.percentage,"onUpdate:modelValue":a[2]||(a[2]=d=>i.itemInfo.percentage=d),placeholder:"请输入百分比"},null,8,["modelValue"])]),e("div",Ue,[a[11]||(a[11]=e("label",null,"*数据下限(%)",-1)),t(c,{modelValue:i.itemInfo.data_lower_limit,"onUpdate:modelValue":a[3]||(a[3]=d=>i.itemInfo.data_lower_limit=d),placeholder:"请输入数据下限"},null,8,["modelValue"])]),e("div",xe,[a[12]||(a[12]=e("label",null,"*数据上限(%)",-1)),t(c,{modelValue:i.itemInfo.data_upper_limit,"onUpdate:modelValue":a[4]||(a[4]=d=>i.itemInfo.data_upper_limit=d),placeholder:"请输入数据上限"},null,8,["modelValue"])]),e("div",je,[a[13]||(a[13]=e("label",null,"*实测数据(%)",-1)),t(c,{modelValue:i.itemInfo.measured_data,"onUpdate:modelValue":a[5]||(a[5]=d=>i.itemInfo.measured_data=d),placeholder:"请输入实测数据"},null,8,["modelValue"])]),e("div",Ee,[a[14]||(a[14]=e("label",null,"*关联任务ID",-1)),t(c,{modelValue:i.itemInfo.task_id,"onUpdate:modelValue":a[6]||(a[6]=d=>i.itemInfo.task_id=d),placeholder:"请输入关联任务ID"},null,8,["modelValue"])])])]),e("div",Te,[t(y,{type:"primary",onClick:_},{default:p(()=>a[15]||(a[15]=[V(" 保存 ")])),_:1}),t(y,{onClick:g},{default:p(()=>a[16]||(a[16]=[V(" 取消 ")])),_:1})])])])):S("",!0)}}},Ae=P(he,[["__scopeId","data-v-432f21ca"]]),Be={class:"modal"},De={class:"modal-content"},ze={class:"form-item"},Se={class:"form-item"},Pe={class:"form-item"},Me={class:"form-item"},Ne={class:"form-item"},Fe={class:"form-item"},Le={class:"form-item"},Re={class:"form-item"},Ke={class:"modal-footer"},Oe={__name:"ViewItem",props:{itemInfo:{type:Object,default:()=>({})},isViewVisible:{type:Boolean,default:!1}},emits:["close"],setup(i,{emit:u}){const I=u,f=()=>{I("close")};return(g,l)=>{const _=z;return i.isViewVisible?(B(),A("div",{key:0,class:"modal-overlay",style:{"z-index":"99"},onClick:F(f,["self"])},[e("div",Be,[e("div",{class:"modal-header"},[l[0]||(l[0]=e("span",null,"查看检测项目详情",-1)),e("button",{onClick:f},"×")]),e("div",De,[e("div",ze,[l[1]||(l[1]=e("label",null,"检测项目ID:",-1)),e("span",null,k(i.itemInfo.item_id),1)]),e("div",Se,[l[2]||(l[2]=e("label",null,"项目:",-1)),e("span",null,k(i.itemInfo.project),1)]),e("div",Pe,[l[3]||(l[3]=e("label",null,"档位:",-1)),e("span",null,k(i.itemInfo.gear),1)]),e("div",Me,[l[4]||(l[4]=e("label",null,"百分比(%):",-1)),e("span",null,k(i.itemInfo.percentage),1)]),e("div",Ne,[l[5]||(l[5]=e("label",null,"数据下限(%):",-1)),e("span",null,k(i.itemInfo.data_lower_limit),1)]),e("div",Fe,[l[6]||(l[6]=e("label",null,"数据上限(%):",-1)),e("span",null,k(i.itemInfo.data_upper_limit),1)]),e("div",Le,[l[7]||(l[7]=e("label",null,"实测数据(%):",-1)),e("span",null,k(i.itemInfo.measured_data),1)]),e("div",Re,[l[8]||(l[8]=e("label",null,"关联任务ID:",-1)),e("span",null,k(i.itemInfo.task_id),1)])]),e("div",Ke,[t(_,{onClick:f},{default:p(()=>l[9]||(l[9]=[V(" 关闭 ")])),_:1})])])])):S("",!0)}}},qe=P(Oe,[["__scopeId","data-v-6d8aa7a4"]]),We={class:"modal"},Ge={class:"modal-content"},He={class:"form-item"},Je={class:"form-item"},Qe={class:"form-item"},Xe={class:"form-item"},Ye={class:"form-item"},Ze={class:"form-item"},el={class:"form-item"},ll={class:"modal-footer"},tl={__name:"AddItem",props:{isAddVisible:{type:Boolean,default:!1},deviceId:{type:String,default:""},taskId:{type:String,default:""}},emits:["close","refresh"],setup(i,{emit:u}){const I=i,f=u,g=()=>{f("close")},l=m({project:"",gearValue:"",gearUnit:"",percentage:null,data_lower_limit:null,data_upper_limit:null,measured_data:null}),_=m([]),b=m(Date.now()),a=()=>{l.value.project.startsWith("PT")?(_.value=[{label:"V",value:"V"}],l.value.gearUnit="V"):l.value.project.startsWith("CT")?(_.value=[{label:"A",value:"A"}],l.value.gearUnit="A"):(_.value=[],l.value.gearUnit="")},c=()=>{const{project:w,gearValue:n,gearUnit:$,percentage:U,data_lower_limit:v,data_upper_limit:x,measured_data:r}=l.value;if(!w||!n||!$||U===null||v===null||x===null||r===null)return T.error("所有输入数据都不能为空"),!1;const E=[U,v,x,r,parseFloat(n)];for(const h of E){if(isNaN(parseFloat(h))||!isFinite(h))return T.error("所有输入的数值数据必须是有效的数字"),!1;if(h<0)return T.error("所有输入的数值数据必须是非负数"),!1}return!0},y=async()=>{if(c()){l.value.task_id=I.taskId,l.value.gear=`${l.value.gearValue}${l.value.gearUnit}`;try{await Ie(l.value),g(),f("refresh"),d()}catch(w){console.error("保存检测项目信息失败",w)}}},d=()=>{l.value={project:"",gearValue:"",gearUnit:"",percentage:null,data_lower_limit:null,data_upper_limit:null,measured_data:null},_.value=[],b.value=Date.now()};return a(),(w,n)=>{const $=ie,U=se,v=N,x=z;return i.isAddVisible?(B(),A("div",{key:b.value,class:"modal-overlay",style:{"z-index":"99"},onClick:F(g,["self"])},[e("div",We,[e("div",{class:"modal-header"},[n[7]||(n[7]=e("span",null,"添加检测项目",-1)),e("button",{onClick:g},"×")]),e("div",Ge,[e("form",null,[e("div",He,[n[8]||(n[8]=e("label",null,"关联设备编号:",-1)),e("span",null,k(i.deviceId),1)]),e("div",Je,[n[9]||(n[9]=e("label",null,"*项目",-1)),t(U,{modelValue:l.value.project,"onUpdate:modelValue":n[0]||(n[0]=r=>l.value.project=r),placeholder:"请选择项目",onChange:a},{default:p(()=>[t($,{label:"PT1",value:"PT1"}),t($,{label:"PT2",value:"PT2"}),t($,{label:"CT1",value:"CT1"}),t($,{label:"CT2",value:"CT2"})]),_:1},8,["modelValue"])]),e("div",Qe,[n[10]||(n[10]=e("label",null,"*档位",-1)),t(v,{modelValue:l.value.gearValue,"onUpdate:modelValue":n[1]||(n[1]=r=>l.value.gearValue=r),placeholder:"请输入档位数值",style:{width:"350px","margin-right":"10px"}},null,8,["modelValue"]),t(U,{modelValue:l.value.gearUnit,"onUpdate:modelValue":n[2]||(n[2]=r=>l.value.gearUnit=r),placeholder:"档位单位",options:_.value,style:{width:"200px"}},null,8,["modelValue","options"])]),e("div",Xe,[n[11]||(n[11]=e("label",null,"*百分比(%)",-1)),t(v,{modelValue:l.value.percentage,"onUpdate:modelValue":n[3]||(n[3]=r=>l.value.percentage=r),placeholder:"请输入百分比"},null,8,["modelValue"])]),e("div",Ye,[n[12]||(n[12]=e("label",null,"*数据下限(%)",-1)),t(v,{modelValue:l.value.data_lower_limit,"onUpdate:modelValue":n[4]||(n[4]=r=>l.value.data_lower_limit=r),placeholder:"请输入数据下限"},null,8,["modelValue"])]),e("div",Ze,[n[13]||(n[13]=e("label",null,"*数据上限(%)",-1)),t(v,{modelValue:l.value.data_upper_limit,"onUpdate:modelValue":n[5]||(n[5]=r=>l.value.data_upper_limit=r),placeholder:"请输入数据上限"},null,8,["modelValue"])]),e("div",el,[n[14]||(n[14]=e("label",null,"*实测数据(%)",-1)),t(v,{modelValue:l.value.measured_data,"onUpdate:modelValue":n[6]||(n[6]=r=>l.value.measured_data=r),placeholder:"请输入实测数据"},null,8,["modelValue"])])])]),e("div",ll,[t(x,{type:"primary",onClick:y},{default:p(()=>n[15]||(n[15]=[V(" 保存 ")])),_:1}),t(x,{onClick:d},{default:p(()=>n[16]||(n[16]=[V(" 重置 ")])),_:1})])])])):S("",!0)}}},ol=P(tl,[["__scopeId","data-v-4d1a78bd"]]),al={class:"list-container"},nl={class:"upper-section"},sl={class:"device-info"},il={key:0},dl={class:"search-filter"},ul={class:"action-buttons"},rl={class:"lower-section"},ml=["onClick"],vl=["onClick"],pl=["onClick"],fl={class:"pagination-wrapper"},cl={__name:"ItemList",setup(i){const u=m([]),I=m(""),f=m(1),g=m(5),l=m(0),_=m([]),b=m(!1),a=m(!1),c=m({}),y=m(!1),d=m({}),w=m(!1),n=de(),$=ue(),U=m(n.query.deviceId||""),v=m(n.params.taskId||""),x=m(n.query.status||"未开始"),r=ce(()=>{const s=(f.value-1)*g.value,o=s+g.value;return u.value.slice(s,o)}),E=async()=>{try{const s=await K();v.value?u.value=s.filter(o=>o.task_id==v.value):u.value=s,l.value=u.value.length}catch(s){console.error("获取检测项目列表失败",s)}},h=()=>{if(x.value==="已完成"){T.warning("实验已完成，不允许添加检测项目");return}a.value=!0},q=s=>{if(x.value==="已完成"){T.warning("实验状态已完成，不允许修改检测项目信息");return}c.value={...s},y.value=!0},W=s=>{d.value={...s},w.value=!0},G=s=>{_.value=s,b.value=s.length>0&&s.length<u.value.length,s.length===u.value.length&&(b.value=!1)},H=s=>{s.length===u.value.length?b.value=!1:s.length>0?b.value=!0:b.value=!1,_.value=s},J=()=>!0,L=async()=>{try{const s=await K();v.value?u.value=s.filter(o=>o.task_id==v.value):u.value=s,u.value=u.value.filter(o=>o.project.includes(I.value)),l.value=u.value.length,f.value=1}catch(s){console.error("搜索检测项目信息失败",s)}},Q=async()=>{try{const s=_.value.map(o=>o.item_id);for(const o of s)await O(o);await E()}catch(s){console.error("批量删除检测项目信息失败",s)}},X=async s=>{try{await O(s),await E()}catch(o){console.error("删除检测项目信息失败",o)}},Y=s=>{Ve.confirm("请问您是否要删除该检测项目信息?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{X(s.item_id)}).catch(()=>{})},Z=s=>{g.value=s},ee=s=>{f.value=s},le=()=>{$.push("/home/task-info")};return be(()=>{E()}),(s,o)=>{const M=me,te=re,oe=N,D=z,C=pe,ae=ve,ne=fe;return B(),A("div",al,[t(te,{separator:"/",class:"breadcrumb"},{default:p(()=>[t(M,null,{default:p(()=>o[4]||(o[4]=[V("首页")])),_:1}),t(M,null,{default:p(()=>o[5]||(o[5]=[V("实验任务管理")])),_:1}),t(M,null,{default:p(()=>o[6]||(o[6]=[V("检测项目管理")])),_:1})]),_:1}),e("div",nl,[e("div",sl,[e("span",null,"当前设备编号："+k(U.value),1),o[7]||(o[7]=e("br",null,null,-1)),v.value?(B(),A("span",il,"当前任务编号："+k(v.value),1)):S("",!0)]),e("div",dl,[t(oe,{modelValue:I.value,"onUpdate:modelValue":o[0]||(o[0]=j=>I.value=j),placeholder:"请输入项目名称",style:{width:"250px",margin:"10px 0"},onKeyup:ge(L,["enter"])},null,8,["modelValue"]),t(D,{type:"primary",onClick:L},{default:p(()=>o[8]||(o[8]=[V(" 搜索 ")])),_:1})]),e("div",ul,[t(D,{type:"danger",onClick:Q},{default:p(()=>o[9]||(o[9]=[V(" 批量删除 ")])),_:1}),t(D,{type:"warning",onClick:h},{default:p(()=>o[10]||(o[10]=[V(" 添加检测项目 ")])),_:1}),t(D,{type:"primary",onClick:le},{default:p(()=>o[11]||(o[11]=[V(" 返回任务列表 ")])),_:1})])]),o[14]||(o[14]=e("br",null,null,-1)),e("div",rl,[t(ae,{data:r.value,border:"",style:{width:"100%","margin-top":"20px"},"cell-style":{textAlign:"center"},"header-cell-style":{textAlign:"center"},onSelectionChange:G},{default:p(()=>[t(C,{type:"selection",width:"50",indeterminate:b.value,selectable:J,onSelectAll:H},null,8,["indeterminate"]),t(C,{prop:"item_id",label:"检测项目ID",width:"120"}),t(C,{prop:"project",label:"项目",width:"100"}),t(C,{prop:"gear",label:"档位",width:"100"}),t(C,{prop:"percentage",label:"百分比(%)",width:"120"}),t(C,{prop:"data_lower_limit",label:"数据下限(%)",width:"150"}),t(C,{prop:"data_upper_limit",label:"数据上限(%)",width:"150"}),t(C,{prop:"measured_data",label:"实测数据(%)",width:"150"}),t(C,{prop:"task_id",label:"关联任务ID",width:"120"}),t(C,{label:"操作",fixed:"right","min-width":"200"},{default:p(j=>[e("a",{href:"javascript:void(0)",onClick:R=>q(j.row)},"编辑",8,ml),o[12]||(o[12]=e("span",{class:"divider"},"|",-1)),e("a",{href:"javascript:void(0)",onClick:R=>W(j.row)},"查看详情",8,vl),o[13]||(o[13]=e("span",{class:"divider"},"|",-1)),e("a",{href:"javascript:void(0)",onClick:R=>Y(j.row)},"删除",8,pl)]),_:1})]),_:1},8,["data"]),e("div",fl,[t(ne,{"current-page":f.value,"page-sizes":[5,10,15],"page-size":g.value,layout:"total, prev, pager, next, sizes, jumper",total:l.value,onSizeChange:Z,onCurrentChange:ee},null,8,["current-page","page-size","total"])])]),t(Ae,{"item-info":c.value,"is-edit-visible":y.value,onClose:o[1]||(o[1]=j=>y.value=!1),onRefresh:E},null,8,["item-info","is-edit-visible"]),t(qe,{"item-info":d.value,"is-view-visible":w.value,onClose:o[2]||(o[2]=j=>w.value=!1)},null,8,["item-info","is-view-visible"]),t(ol,{"is-add-visible":a.value,"device-id":U.value,"task-id":v.value,onClose:o[3]||(o[3]=j=>a.value=!1),onRefresh:E},null,8,["is-add-visible","device-id","task-id"])])}}},Vl=P(cl,[["__scopeId","data-v-36739df2"]]);export{Vl as default};
