import{f as _}from"./vue-core-C_l77I1y.js";import{_ as x,e as L,c as F,d as K,g as C,f as h}from"./index-CgfAAbnT.js";import"vue";const O=(l,s,n)=>{if(s==null||s===""){n(new Error("ID不能为空"));return}const i=Number(s);if(isNaN(i)){n(new Error("ID必须是有效的数字"));return}if(!Number.isInteger(i)){n(new Error("ID必须是整数"));return}if(i<=0){n(new Error("ID必须是正整数"));return}n()},k={__name:"DeviceForm",props:{deviceInfo:{type:Object,default:()=>({})}},setup(l,{expose:s}){const n=Vue.ref(null),i={deviceId:[{required:!0,message:"请输入设备ID",trigger:"blur"},{validator:O,message:"设备ID必须是数字",trigger:"blur"}],deviceName:[{required:!0,message:"请输入设备名称",trigger:"blur"},{min:3,max:10,message:"设备名称长度必须在3到10之间",trigger:"blur"}],deviceModel:[{required:!0,message:"请输入设备型号",trigger:"blur"},{min:1,max:10,message:"设备型号长度必须在1到10之间",trigger:"blur"}],manufacturer:[{required:!0,message:"请输入制造商",trigger:"blur"},{min:3,max:15,message:"制造商长度必须在3到15之间",trigger:"blur"}],productionPlace:[{required:!0,message:"请输入产地",trigger:"blur"},{min:3,max:15,message:"产地长度必须在3到15之间",trigger:"blur"}]};return s({formRef:n}),(V,e)=>{const d=Vue.__unplugin_components_0,u=Vue.__unplugin_components_1,r=Vue.__unplugin_components_2,v=Vue.__unplugin_components_3,y=Vue.__unplugin_components_4,g=Vue.__unplugin_components_5;return Vue.openBlock(),Vue.createBlock(g,{ref_key:"formRef",ref:n,model:l.deviceInfo,rules:i},{default:Vue.withCtx(()=>[Vue.createVNode(u,{label:"设备ID",prop:"deviceId"},{default:Vue.withCtx(()=>[Vue.createVNode(d,{modelValue:l.deviceInfo.deviceId,"onUpdate:modelValue":e[0]||(e[0]=c=>l.deviceInfo.deviceId=c),placeholder:"请输入设备ID"},null,8,["modelValue"])]),_:1}),Vue.createVNode(u,{label:"设备名称",prop:"deviceName"},{default:Vue.withCtx(()=>[Vue.createVNode(d,{modelValue:l.deviceInfo.deviceName,"onUpdate:modelValue":e[1]||(e[1]=c=>l.deviceInfo.deviceName=c),placeholder:"请输入设备名称"},null,8,["modelValue"])]),_:1}),Vue.createVNode(u,{label:"设备型号",prop:"deviceModel"},{default:Vue.withCtx(()=>[Vue.createVNode(d,{modelValue:l.deviceInfo.deviceModel,"onUpdate:modelValue":e[2]||(e[2]=c=>l.deviceInfo.deviceModel=c),placeholder:"请输入设备型号"},null,8,["modelValue"])]),_:1}),Vue.createVNode(u,{label:"生产日期",prop:"manufactureDate"},{default:Vue.withCtx(()=>[Vue.createVNode(r,{modelValue:l.deviceInfo.manufactureDate,"onUpdate:modelValue":e[3]||(e[3]=c=>l.deviceInfo.manufactureDate=c),type:"datetime",placeholder:"请选择生产日期",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),Vue.createVNode(u,{label:"送检日期",prop:"inspectionDate"},{default:Vue.withCtx(()=>[Vue.createVNode(r,{modelValue:l.deviceInfo.inspectionDate,"onUpdate:modelValue":e[4]||(e[4]=c=>l.deviceInfo.inspectionDate=c),type:"datetime",placeholder:"请选择送检日期",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),Vue.createVNode(u,{label:"制造商",prop:"manufacturer"},{default:Vue.withCtx(()=>[Vue.createVNode(d,{modelValue:l.deviceInfo.manufacturer,"onUpdate:modelValue":e[5]||(e[5]=c=>l.deviceInfo.manufacturer=c),placeholder:"请输入制造商"},null,8,["modelValue"])]),_:1}),Vue.createVNode(u,{label:"产地",prop:"productionPlace"},{default:Vue.withCtx(()=>[Vue.createVNode(d,{modelValue:l.deviceInfo.productionPlace,"onUpdate:modelValue":e[6]||(e[6]=c=>l.deviceInfo.productionPlace=c),placeholder:"请输入产地"},null,8,["modelValue"])]),_:1}),Vue.createVNode(u,{label:"设备状态",prop:"deviceStatus"},{default:Vue.withCtx(()=>[Vue.createVNode(y,{modelValue:l.deviceInfo.deviceStatus,"onUpdate:modelValue":e[7]||(e[7]=c=>l.deviceInfo.deviceStatus=c)},{default:Vue.withCtx(()=>[Vue.createVNode(v,{label:"已检测"},{default:Vue.withCtx(()=>e[8]||(e[8]=[Vue.createTextVNode(" 已检测 ")])),_:1}),Vue.createVNode(v,{label:"未检测"},{default:Vue.withCtx(()=>e[9]||(e[9]=[Vue.createTextVNode(" 未检测 ")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])}}},G={class:"modal"},J={class:"modal-content"},Q={class:"modal-footer"},W={__name:"EditDevice",props:{deviceInfo:{type:Object,default:()=>({})},isEditVisible:{type:Boolean,default:!1}},emits:["close","refresh"],setup(l,{emit:s}){const n=l,i=s,a=()=>{i("close")},V=Vue.ref(null),e=async()=>{V.value.formRef.validate(async d=>{if(d){if(n.deviceInfo.id){n.deviceInfo.manufactureDate&&(n.deviceInfo.manufactureDate=_(n.deviceInfo.manufactureDate,"yyyy-MM-dd HH:mm:ss")),n.deviceInfo.inspectionDate&&(n.deviceInfo.inspectionDate=_(n.deviceInfo.inspectionDate,"yyyy-MM-dd HH:mm:ss"));try{await L(n.deviceInfo),i("close"),i("refresh")}catch(u){console.error("编辑设备信息失败",u)}}}else return ElementPlus.ElMessage.error("表单验证不通过，请检查输入信息"),!1})};return(d,u)=>{const r=Vue.__unplugin_components_0;return l.isEditVisible?(Vue.openBlock(),Vue.createElementBlock("div",{key:0,class:"modal-overlay",style:{"z-index":"99"},onClick:Vue.withModifiers(a,["self"])},[Vue.createElementVNode("div",G,[Vue.createElementVNode("div",{class:"modal-header"},[u[0]||(u[0]=Vue.createElementVNode("span",null,"编辑设备信息",-1)),Vue.createElementVNode("button",{onClick:a},"×")]),Vue.createElementVNode("div",J,[Vue.createVNode(k,{ref_key:"formRef",ref:V,"device-info":l.deviceInfo},null,8,["device-info"])]),Vue.createElementVNode("div",Q,[Vue.createVNode(r,{type:"primary",onClick:e},{default:Vue.withCtx(()=>u[1]||(u[1]=[Vue.createTextVNode(" 保存 ")])),_:1}),Vue.createVNode(r,{onClick:a},{default:Vue.withCtx(()=>u[2]||(u[2]=[Vue.createTextVNode(" 取消 ")])),_:1})])])])):Vue.createCommentVNode("",!0)}}},X=x(W,[["__scopeId","data-v-7c9175bb"]]),Y={class:"modal"},Z={class:"modal-content"},ee={class:"form-item"},te={class:"form-item"},oe={class:"form-item"},le={class:"form-item"},ne={class:"form-item"},ae={class:"form-item"},ue={class:"form-item"},ie={class:"form-item"},de={class:"modal-footer"},re={__name:"ViewDevice",props:{deviceInfo:{type:Object,default:()=>({})},isViewVisible:{type:Boolean,default:!1}},emits:["close"],setup(l,{emit:s}){const n=s,i=()=>{n("close")},a=V=>V?_(new Date(V),"yyyy-MM-dd HH:mm:ss"):"";return(V,e)=>{const d=Vue.__unplugin_components_0;return l.isViewVisible?(Vue.openBlock(),Vue.createElementBlock("div",{key:0,class:"modal-overlay",style:{"z-index":"99"},onClick:Vue.withModifiers(i,["self"])},[Vue.createElementVNode("div",Y,[Vue.createElementVNode("div",{class:"modal-header"},[e[0]||(e[0]=Vue.createElementVNode("span",null,"查看详情",-1)),Vue.createElementVNode("button",{onClick:i},"×")]),Vue.createElementVNode("div",Z,[Vue.createElementVNode("div",ee,[e[1]||(e[1]=Vue.createElementVNode("label",null,"设备ID:",-1)),Vue.createElementVNode("span",null,Vue.toDisplayString(l.deviceInfo.deviceId),1)]),Vue.createElementVNode("div",te,[e[2]||(e[2]=Vue.createElementVNode("label",null,"设备名称:",-1)),Vue.createElementVNode("span",null,Vue.toDisplayString(l.deviceInfo.deviceName),1)]),Vue.createElementVNode("div",oe,[e[3]||(e[3]=Vue.createElementVNode("label",null,"设备型号:",-1)),Vue.createElementVNode("span",null,Vue.toDisplayString(l.deviceInfo.deviceModel),1)]),Vue.createElementVNode("div",le,[e[4]||(e[4]=Vue.createElementVNode("label",null,"制造商:",-1)),Vue.createElementVNode("span",null,Vue.toDisplayString(l.deviceInfo.manufacturer),1)]),Vue.createElementVNode("div",ne,[e[5]||(e[5]=Vue.createElementVNode("label",null,"产地:",-1)),Vue.createElementVNode("span",null,Vue.toDisplayString(l.deviceInfo.productionPlace),1)]),Vue.createElementVNode("div",ae,[e[6]||(e[6]=Vue.createElementVNode("label",null,"生产日期:",-1)),Vue.createElementVNode("span",null,Vue.toDisplayString(a(l.deviceInfo.manufactureDate)),1)]),Vue.createElementVNode("div",ue,[e[7]||(e[7]=Vue.createElementVNode("label",null,"送检日期:",-1)),Vue.createElementVNode("span",null,Vue.toDisplayString(a(l.deviceInfo.inspectionDate)),1)]),Vue.createElementVNode("div",ie,[e[8]||(e[8]=Vue.createElementVNode("label",null,"设备状态:",-1)),Vue.createElementVNode("span",null,Vue.toDisplayString(l.deviceInfo.deviceStatus),1)])]),Vue.createElementVNode("div",de,[Vue.createVNode(d,{onClick:i},{default:Vue.withCtx(()=>e[9]||(e[9]=[Vue.createTextVNode(" 关闭 ")])),_:1})])])])):Vue.createCommentVNode("",!0)}}},se=x(re,[["__scopeId","data-v-477c83c5"]]),ce={class:"modal"},Ve={class:"modal-content"},me={class:"modal-footer"},fe={__name:"AddDevice",props:{isAddVisible:{type:Boolean,default:!1}},emits:["close","refresh"],setup(l,{emit:s}){const n=s,i=()=>{n("close")},a=Vue.ref({deviceId:"",deviceName:"",deviceModel:"",manufactureDate:null,inspectionDate:null,manufacturer:"",productionPlace:"",deviceStatus:""}),V=Vue.ref(null),e=async()=>{V.value.formRef.validate(async u=>{if(u){a.value.manufactureDate&&a.value.inspectionDate&&(a.value.manufactureDate=_(a.value.manufactureDate,"yyyy-MM-dd HH:mm:ss"),a.value.inspectionDate=_(a.value.inspectionDate,"yyyy-MM-dd HH:mm:ss"));try{const r=await F(a.value.deviceId);if(console.log(r.exist),r.exist!==0){ElementPlus.ElMessage.error("该设备编号已存在，请重新输入设备编号");return}await K(a.value),i(),n("refresh"),d()}catch(r){console.error("保存设备信息失败",r)}}else return ElementPlus.ElMessage.error("表单验证不通过，请检查输入信息"),!1})},d=()=>{a.value={deviceId:"",deviceName:"",deviceModel:"",manufactureDate:null,inspectionDate:null,manufacturer:"",productionPlace:"",deviceStatus:""},V.value.formRef.resetFields()};return(u,r)=>{const v=Vue.__unplugin_components_0;return l.isAddVisible?(Vue.openBlock(),Vue.createElementBlock("div",{key:0,class:"modal-overlay",style:{"z-index":"99"},onClick:Vue.withModifiers(i,["self"])},[Vue.createElementVNode("div",ce,[Vue.createElementVNode("div",{class:"modal-header"},[r[0]||(r[0]=Vue.createElementVNode("span",null,"添加设备",-1)),Vue.createElementVNode("button",{onClick:i},"×")]),Vue.createElementVNode("div",Ve,[Vue.createVNode(k,{ref_key:"formRef",ref:V,"device-info":a.value},null,8,["device-info"])]),Vue.createElementVNode("div",me,[Vue.createVNode(v,{type:"primary",onClick:e},{default:Vue.withCtx(()=>r[1]||(r[1]=[Vue.createTextVNode(" 保存 ")])),_:1}),Vue.createVNode(v,{onClick:d},{default:Vue.withCtx(()=>r[2]||(r[2]=[Vue.createTextVNode(" 重置 ")])),_:1})])])])):Vue.createCommentVNode("",!0)}}},ve=x(fe,[["__scopeId","data-v-da1111fc"]]),pe={class:"list-container"},Ne={class:"upper-section"},_e={class:"search-filter"},ge={class:"action-buttons"},ye={class:"lower-section"},xe=["onClick"],be=["onClick"],De=["onClick"],Ee={class:"pagination-wrapper"},we={__name:"DeviceList",setup(l){const s=Vue.ref([]),n=Vue.ref(""),i=Vue.ref(1),a=Vue.ref(5),V=Vue.ref(0),e=Vue.ref([]),d=Vue.ref(!1),u=Vue.ref(!1),r=Vue.ref({}),v=Vue.ref(!1),y=Vue.ref({}),g=Vue.ref(!1),c=t=>t?_(new Date(t),"yyyy-MM-dd"):"",p=async()=>{try{const t=await C();V.value=t.length;const o=(i.value-1)*a.value,N=o+a.value;s.value=t.slice(o,N)}catch(t){console.error("获取设备列表失败",t)}},M=()=>{u.value=!0},$=t=>{r.value={...t},v.value=!0,p()},S=t=>{y.value={...t},g.value=!0},B=t=>{e.value=t,d.value=t.length>0&&t.length<s.value.length,t.length===s.value.length&&(d.value=!1)},T=t=>{t.length===s.value.length?d.value=!1:t.length>0?d.value=!0:d.value=!1,e.value=t},P=()=>!0,w=async()=>{try{const o=(await C()).filter(D=>D.deviceName.includes(n.value));V.value=o.length,i.value=1;const N=0,b=a.value;s.value=o.slice(N,b)}catch(t){console.error("搜索设备信息失败",t)}},R=async()=>{try{const t=e.value.map(o=>o.id);for(const o of t)await h(o);await p()}catch(t){console.error("批量删除设备信息失败",t)}},H=async t=>{try{await h(t),await p()}catch(o){console.error("删除设备信息失败",o)}},z=t=>{ElementPlus.ElMessageBox.confirm("请问您是否要删除该设备信息信息?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{H(t.id)}).catch(()=>{})},A=t=>{console.log("新的每页数量:",t),a.value=t,p()},U=t=>{console.log("新的页码:",t),i.value=t,p()};return p(),(t,o)=>{const N=Vue.__unplugin_components_0,b=Vue.__unplugin_components_1,D=Vue.__unplugin_components_2,E=Vue.__unplugin_components_3,f=Vue.__unplugin_components_4,j=Vue.__unplugin_components_5,q=Vue.__unplugin_components_6;return Vue.openBlock(),Vue.createElementBlock("div",pe,[Vue.createVNode(b,{separator:"/",class:"breadcrumb"},{default:Vue.withCtx(()=>[Vue.createVNode(N,null,{default:Vue.withCtx(()=>o[4]||(o[4]=[Vue.createTextVNode("首页")])),_:1}),Vue.createVNode(N,null,{default:Vue.withCtx(()=>o[5]||(o[5]=[Vue.createTextVNode("设备管理")])),_:1})]),_:1}),Vue.createElementVNode("div",Ne,[Vue.createElementVNode("div",_e,[Vue.createVNode(D,{modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=m=>n.value=m),placeholder:"请输入设备名称",style:{width:"250px",margin:"10px 0"},onKeyup:Vue.withKeys(w,["enter"])},null,8,["modelValue"]),Vue.createVNode(E,{type:"primary",onClick:w},{default:Vue.withCtx(()=>o[6]||(o[6]=[Vue.createTextVNode(" 搜索 ")])),_:1})]),Vue.createElementVNode("div",ge,[Vue.createVNode(E,{type:"danger",onClick:R},{default:Vue.withCtx(()=>o[7]||(o[7]=[Vue.createTextVNode(" 批量删除 ")])),_:1}),Vue.createVNode(E,{type:"warning",onClick:M},{default:Vue.withCtx(()=>o[8]||(o[8]=[Vue.createTextVNode(" 添加设备 ")])),_:1})])]),o[11]||(o[11]=Vue.createElementVNode("br",null,null,-1)),Vue.createElementVNode("div",ye,[Vue.createVNode(j,{data:s.value,border:"",style:{width:"100%","margin-top":"20px"},"cell-style":{textAlign:"center"},"header-cell-style":{textAlign:"center"},onSelectionChange:B},{default:Vue.withCtx(()=>[Vue.createVNode(f,{type:"selection",width:"50",indeterminate:d.value,selectable:P,onSelectAll:T},null,8,["indeterminate"]),Vue.createVNode(f,{prop:"deviceId",label:"设备ID",width:"100"}),Vue.createVNode(f,{prop:"deviceName",label:"设备名称",width:"100"}),Vue.createVNode(f,{prop:"deviceModel",label:"设备型号",width:"100"}),Vue.createVNode(f,{prop:"manufactureDate",label:"生产日期",width:"200"},{default:Vue.withCtx(m=>[Vue.createTextVNode(Vue.toDisplayString(c(m.row.manufactureDate)),1)]),_:1}),Vue.createVNode(f,{prop:"inspectionDate",label:"送检日期",width:"200"},{default:Vue.withCtx(m=>[Vue.createTextVNode(Vue.toDisplayString(c(m.row.inspectionDate)),1)]),_:1}),Vue.createVNode(f,{prop:"manufacturer",label:"制造商",width:"140"}),Vue.createVNode(f,{prop:"productionPlace",label:"产地",width:"140"}),Vue.createVNode(f,{prop:"deviceStatus",label:"设备状态",width:"100"}),Vue.createVNode(f,{label:"操作",fixed:"right","min-width":"200"},{default:Vue.withCtx(m=>[Vue.createElementVNode("a",{href:"javascript:void(0)",onClick:I=>$(m.row)},"编辑",8,xe),o[9]||(o[9]=Vue.createElementVNode("span",{class:"divider"},"|",-1)),Vue.createElementVNode("a",{href:"javascript:void(0)",onClick:I=>S(m.row)},"查看详情",8,be),o[10]||(o[10]=Vue.createElementVNode("span",{class:"divider"},"|",-1)),Vue.createElementVNode("a",{href:"javascript:void(0)",onClick:I=>z(m.row)},"删除",8,De)]),_:1})]),_:1},8,["data"]),Vue.createElementVNode("div",Ee,[Vue.createVNode(q,{"current-page":i.value,"page-sizes":[5,10,15],"page-size":a.value,layout:"total, prev, pager, next, sizes, jumper",total:V.value,onSizeChange:A,onCurrentChange:U},null,8,["current-page","page-size","total"])])]),Vue.createVNode(X,{"device-info":r.value,"is-edit-visible":v.value,onClose:o[1]||(o[1]=m=>v.value=!1),onRefresh:p},null,8,["device-info","is-edit-visible"]),Vue.createVNode(se,{"device-info":y.value,"is-view-visible":g.value,onClose:o[2]||(o[2]=m=>g.value=!1)},null,8,["device-info","is-view-visible"]),Vue.createVNode(ve,{"is-add-visible":u.value,onClose:o[3]||(o[3]=m=>u.value=!1),onRefresh:p},null,8,["is-add-visible"])])}}},ke=x(we,[["__scopeId","data-v-6aeeb076"]]);export{ke as default};
