import{e as v,f as k,M as x,c as E,g as p,a,w as t,k as F,F as q,i as U,u as I,o as P,l as $,m as M,p as R,q as f,t as T,s as w,L as N}from"./vue-core-ejNiufTe.js";import{r as S,a as D}from"./index-C-2LZmHF.js";const L={class:"wrapper"},z={class:"reset-form"},H={__name:"ForgetPassword",setup(A){const c=I(),m=v(null),r=v({username:"",phone:"",verifyCode:"",password1:"",password2:""}),b={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:4,max:15,message:"用户名长度需在4到15个字符",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1\d{10}$/,message:"手机号格式不正确",trigger:"blur"}],verifyCode:[{required:!0,message:"请输入验证码",trigger:"blur"},{pattern:/^\d{4}$/,message:"验证码需为4位数字",trigger:"blur"}],password1:[{required:!0,message:"请输入密码",trigger:"blur"},{pattern:/^[A-Za-z\d]{6,10}$/,message:"密码需6-10位字母或数字",trigger:"blur"}],password2:[{required:!0,message:"请再次确定密码",trigger:"blur"},{validator:(o,e,l)=>{e!==r.value.password1?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]},u=v(60);let i=null;const V=k(()=>/^1\d{10}$/.test(r.value.phone)),_=()=>{u.value=60,i=setInterval(()=>{u.value--,u.value<=0&&g()},1e3)},g=()=>{clearInterval(i),u.value=0,i=null};x(()=>{i&&g()});const C=async()=>{try{await m.value.validateField("phone"),_();const o=await S(r.value.phone);o.code!==0&&(w.warning(o.msg),g())}catch(o){console.log("获取密码失败：",o)}},y=async()=>{try{if(!await m.value.validate())return;const{phone:e,verifyCode:l,password1:n}=r.value,d=await D(e,l,n);d.code===0?(await N.alert("密码重置成功，将返回登录页面","成功",{type:"success",confirmButtonText:"确定"}),c.push("/login")):w.warning(d.msg)}catch(o){console.error("密码重置失败:",o),w.error("操作失败，请检查输入信息")}},h=()=>{c.push("/login")};return(o,e)=>{const l=M,n=$,d=R,B=U;return P(),E(q,null,[e[8]||(e[8]=p("div",{class:"header"},[p("p",null,"互感器二次压降检测仪检定系统")],-1)),p("div",L,[e[7]||(e[7]=p("h1",null,"▎重置密码",-1)),p("div",z,[a(B,{ref_key:"FormRef",ref:m,model:r.value,rules:b,onSubmit:F(y,["prevent"])},{default:t(()=>[a(n,{label:"登录账号：",prop:"username"},{default:t(()=>[a(l,{modelValue:r.value.username,"onUpdate:modelValue":e[0]||(e[0]=s=>r.value.username=s),placeholder:"请输入账号"},null,8,["modelValue"])]),_:1}),a(n,{label:"手机号码：",prop:"phone"},{default:t(()=>[a(l,{modelValue:r.value.phone,"onUpdate:modelValue":e[1]||(e[1]=s=>r.value.phone=s),placeholder:"请输入手机号码"},null,8,["modelValue"])]),_:1}),a(n,{label:"验证码：",prop:"verifyCode"},{default:t(()=>[a(l,{modelValue:r.value.verifyCode,"onUpdate:modelValue":e[2]||(e[2]=s=>r.value.verifyCode=s),placeholder:"请输入验证码",style:{flex:"1"}},null,8,["modelValue"]),a(d,{disabled:!V.value,type:"primary",style:{right:"0"},onClick:C},{default:t(()=>[f(T(u.value<60?`${u.value}秒后重试`:"获取验证码"),1)]),_:1},8,["disabled"])]),_:1}),a(n,{label:"新密码：",prop:"password1"},{default:t(()=>[a(l,{modelValue:r.value.password1,"onUpdate:modelValue":e[3]||(e[3]=s=>r.value.password1=s),type:"password","show-password":"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),a(n,{label:"密码二次确认：",prop:"password2"},{default:t(()=>[a(l,{modelValue:r.value.password2,"onUpdate:modelValue":e[4]||(e[4]=s=>r.value.password2=s),type:"password","show-password":"",placeholder:"请再次确认密码"},null,8,["modelValue"])]),_:1}),a(d,{type:"primary",class:"backBtn",onClick:h},{default:t(()=>e[5]||(e[5]=[f(" 返回登录页面 ")])),_:1}),a(d,{type:"primary",class:"resetBtn",onClick:y},{default:t(()=>e[6]||(e[6]=[f(" 确定重置密码 ")])),_:1})]),_:1},8,["model"])])])],64)}}};export{H as default};
