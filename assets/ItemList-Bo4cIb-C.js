import{b as G,u as H}from"./vue-core-C_l77I1y.js";import{_ as k,l as J,m as Q,n as T,o as U}from"./index-CgfAAbnT.js";import"vue";const X={class:"modal"},Y={class:"modal-content"},Z={class:"form-item"},ee={class:"form-item"},te={class:"form-item"},le={class:"form-item"},oe={class:"form-item"},ne={class:"form-item"},ae={class:"form-item"},ue={class:"modal-footer"},de={__name:"EditItem",props:{itemInfo:{type:Object,default:()=>({})},isEditVisible:{type:Boolean,default:!1}},emits:["close","refresh"],setup(a,{emit:d}){const v=a,s=d,c=()=>{s("close")},e=()=>{const{project:m,gear:l,percentage:V,data_lower_limit:f,data_upper_limit:u,measured_data:N,task_id:o}=v.itemInfo;return!m||!l||V===null||f===null||u===null||N===null||!o?(ElementPlus.ElMessage.error("所有输入数据都不能为空"),!1):V<=0||f<=0||u<=0||N<=0?(ElementPlus.ElMessage.error("所有百分比、数据下限、数据上限和实测数据必须大于 0"),!1):!0},p=async()=>{if(e()&&v.itemInfo.item_id)try{await J(v.itemInfo.item_id,v.itemInfo),s("close"),s("refresh")}catch(m){console.error("编辑检测项目信息失败",m)}};return(m,l)=>{const V=Vue.__unplugin_components_0,f=Vue.__unplugin_components_1;return a.isEditVisible?(Vue.openBlock(),Vue.createElementBlock("div",{key:0,class:"modal-overlay",style:{"z-index":"99"},onClick:Vue.withModifiers(c,["self"])},[Vue.createElementVNode("div",X,[Vue.createElementVNode("div",{class:"modal-header"},[l[7]||(l[7]=Vue.createElementVNode("span",null,"编辑检测项目信息",-1)),Vue.createElementVNode("button",{onClick:c},"×")]),Vue.createElementVNode("div",Y,[Vue.createElementVNode("form",null,[Vue.createElementVNode("div",Z,[l[8]||(l[8]=Vue.createElementVNode("label",null,"*项目",-1)),Vue.createVNode(V,{modelValue:a.itemInfo.project,"onUpdate:modelValue":l[0]||(l[0]=u=>a.itemInfo.project=u),placeholder:"请输入项目"},null,8,["modelValue"])]),Vue.createElementVNode("div",ee,[l[9]||(l[9]=Vue.createElementVNode("label",null,"档位",-1)),Vue.createVNode(V,{modelValue:a.itemInfo.gear,"onUpdate:modelValue":l[1]||(l[1]=u=>a.itemInfo.gear=u),placeholder:"请输入档位"},null,8,["modelValue"])]),Vue.createElementVNode("div",te,[l[10]||(l[10]=Vue.createElementVNode("label",null,"*百分比(%)",-1)),Vue.createVNode(V,{modelValue:a.itemInfo.percentage,"onUpdate:modelValue":l[2]||(l[2]=u=>a.itemInfo.percentage=u),placeholder:"请输入百分比"},null,8,["modelValue"])]),Vue.createElementVNode("div",le,[l[11]||(l[11]=Vue.createElementVNode("label",null,"*数据下限(%)",-1)),Vue.createVNode(V,{modelValue:a.itemInfo.data_lower_limit,"onUpdate:modelValue":l[3]||(l[3]=u=>a.itemInfo.data_lower_limit=u),placeholder:"请输入数据下限"},null,8,["modelValue"])]),Vue.createElementVNode("div",oe,[l[12]||(l[12]=Vue.createElementVNode("label",null,"*数据上限(%)",-1)),Vue.createVNode(V,{modelValue:a.itemInfo.data_upper_limit,"onUpdate:modelValue":l[4]||(l[4]=u=>a.itemInfo.data_upper_limit=u),placeholder:"请输入数据上限"},null,8,["modelValue"])]),Vue.createElementVNode("div",ne,[l[13]||(l[13]=Vue.createElementVNode("label",null,"*实测数据(%)",-1)),Vue.createVNode(V,{modelValue:a.itemInfo.measured_data,"onUpdate:modelValue":l[5]||(l[5]=u=>a.itemInfo.measured_data=u),placeholder:"请输入实测数据"},null,8,["modelValue"])]),Vue.createElementVNode("div",ae,[l[14]||(l[14]=Vue.createElementVNode("label",null,"*关联任务ID",-1)),Vue.createVNode(V,{modelValue:a.itemInfo.task_id,"onUpdate:modelValue":l[6]||(l[6]=u=>a.itemInfo.task_id=u),placeholder:"请输入关联任务ID"},null,8,["modelValue"])])])]),Vue.createElementVNode("div",ue,[Vue.createVNode(f,{type:"primary",onClick:p},{default:Vue.withCtx(()=>l[15]||(l[15]=[Vue.createTextVNode(" 保存 ")])),_:1}),Vue.createVNode(f,{onClick:c},{default:Vue.withCtx(()=>l[16]||(l[16]=[Vue.createTextVNode(" 取消 ")])),_:1})])])])):Vue.createCommentVNode("",!0)}}},ie=k(de,[["__scopeId","data-v-432f21ca"]]),re={class:"modal"},se={class:"modal-content"},Ve={class:"form-item"},me={class:"form-item"},ce={class:"form-item"},pe={class:"form-item"},ve={class:"form-item"},fe={class:"form-item"},Ne={class:"form-item"},_e={class:"form-item"},Ee={class:"modal-footer"},ge={__name:"ViewItem",props:{itemInfo:{type:Object,default:()=>({})},isViewVisible:{type:Boolean,default:!1}},emits:["close"],setup(a,{emit:d}){const v=d,s=()=>{v("close")};return(c,e)=>{const p=Vue.__unplugin_components_0;return a.isViewVisible?(Vue.openBlock(),Vue.createElementBlock("div",{key:0,class:"modal-overlay",style:{"z-index":"99"},onClick:Vue.withModifiers(s,["self"])},[Vue.createElementVNode("div",re,[Vue.createElementVNode("div",{class:"modal-header"},[e[0]||(e[0]=Vue.createElementVNode("span",null,"查看检测项目详情",-1)),Vue.createElementVNode("button",{onClick:s},"×")]),Vue.createElementVNode("div",se,[Vue.createElementVNode("div",Ve,[e[1]||(e[1]=Vue.createElementVNode("label",null,"检测项目ID:",-1)),Vue.createElementVNode("span",null,Vue.toDisplayString(a.itemInfo.item_id),1)]),Vue.createElementVNode("div",me,[e[2]||(e[2]=Vue.createElementVNode("label",null,"项目:",-1)),Vue.createElementVNode("span",null,Vue.toDisplayString(a.itemInfo.project),1)]),Vue.createElementVNode("div",ce,[e[3]||(e[3]=Vue.createElementVNode("label",null,"档位:",-1)),Vue.createElementVNode("span",null,Vue.toDisplayString(a.itemInfo.gear),1)]),Vue.createElementVNode("div",pe,[e[4]||(e[4]=Vue.createElementVNode("label",null,"百分比(%):",-1)),Vue.createElementVNode("span",null,Vue.toDisplayString(a.itemInfo.percentage),1)]),Vue.createElementVNode("div",ve,[e[5]||(e[5]=Vue.createElementVNode("label",null,"数据下限(%):",-1)),Vue.createElementVNode("span",null,Vue.toDisplayString(a.itemInfo.data_lower_limit),1)]),Vue.createElementVNode("div",fe,[e[6]||(e[6]=Vue.createElementVNode("label",null,"数据上限(%):",-1)),Vue.createElementVNode("span",null,Vue.toDisplayString(a.itemInfo.data_upper_limit),1)]),Vue.createElementVNode("div",Ne,[e[7]||(e[7]=Vue.createElementVNode("label",null,"实测数据(%):",-1)),Vue.createElementVNode("span",null,Vue.toDisplayString(a.itemInfo.measured_data),1)]),Vue.createElementVNode("div",_e,[e[8]||(e[8]=Vue.createElementVNode("label",null,"关联任务ID:",-1)),Vue.createElementVNode("span",null,Vue.toDisplayString(a.itemInfo.task_id),1)])]),Vue.createElementVNode("div",Ee,[Vue.createVNode(p,{onClick:s},{default:Vue.withCtx(()=>e[9]||(e[9]=[Vue.createTextVNode(" 关闭 ")])),_:1})])])])):Vue.createCommentVNode("",!0)}}},be=k(ge,[["__scopeId","data-v-6d8aa7a4"]]),Ie={class:"modal"},we={class:"modal-content"},ye={class:"form-item"},Ce={class:"form-item"},ke={class:"form-item"},xe={class:"form-item"},$e={class:"form-item"},he={class:"form-item"},Te={class:"form-item"},Ue={class:"modal-footer"},De={__name:"AddItem",props:{isAddVisible:{type:Boolean,default:!1},deviceId:{type:String,default:""},taskId:{type:String,default:""}},emits:["close","refresh"],setup(a,{emit:d}){const v=a,s=d,c=()=>{s("close")},e=Vue.ref({project:"",gearValue:"",gearUnit:"",percentage:null,data_lower_limit:null,data_upper_limit:null,measured_data:null}),p=Vue.ref([]),m=Vue.ref(Date.now()),l=()=>{e.value.project.startsWith("PT")?(p.value=[{label:"V",value:"V"}],e.value.gearUnit="V"):e.value.project.startsWith("CT")?(p.value=[{label:"A",value:"A"}],e.value.gearUnit="A"):(p.value=[],e.value.gearUnit="")},V=()=>{const{project:N,gearValue:o,gearUnit:E,percentage:g,data_lower_limit:r,data_upper_limit:b,measured_data:i}=e.value;if(!N||!o||!E||g===null||r===null||b===null||i===null)return ElementPlus.ElMessage.error("所有输入数据都不能为空"),!1;const w=[g,r,b,i,parseFloat(o)];for(const y of w){if(isNaN(parseFloat(y))||!isFinite(y))return ElementPlus.ElMessage.error("所有输入的数值数据必须是有效的数字"),!1;if(y<0)return ElementPlus.ElMessage.error("所有输入的数值数据必须是非负数"),!1}return!0},f=async()=>{if(V()){e.value.task_id=v.taskId,e.value.gear=`${e.value.gearValue}${e.value.gearUnit}`;try{await Q(e.value),c(),s("refresh"),u()}catch(N){console.error("保存检测项目信息失败",N)}}},u=()=>{e.value={project:"",gearValue:"",gearUnit:"",percentage:null,data_lower_limit:null,data_upper_limit:null,measured_data:null},p.value=[],m.value=Date.now()};return l(),(N,o)=>{const E=Vue.__unplugin_components_0,g=Vue.__unplugin_components_1,r=Vue.__unplugin_components_2,b=Vue.__unplugin_components_3;return a.isAddVisible?(Vue.openBlock(),Vue.createElementBlock("div",{key:m.value,class:"modal-overlay",style:{"z-index":"99"},onClick:Vue.withModifiers(c,["self"])},[Vue.createElementVNode("div",Ie,[Vue.createElementVNode("div",{class:"modal-header"},[o[7]||(o[7]=Vue.createElementVNode("span",null,"添加检测项目",-1)),Vue.createElementVNode("button",{onClick:c},"×")]),Vue.createElementVNode("div",we,[Vue.createElementVNode("form",null,[Vue.createElementVNode("div",ye,[o[8]||(o[8]=Vue.createElementVNode("label",null,"关联设备编号:",-1)),Vue.createElementVNode("span",null,Vue.toDisplayString(a.deviceId),1)]),Vue.createElementVNode("div",Ce,[o[9]||(o[9]=Vue.createElementVNode("label",null,"*项目",-1)),Vue.createVNode(g,{modelValue:e.value.project,"onUpdate:modelValue":o[0]||(o[0]=i=>e.value.project=i),placeholder:"请选择项目",onChange:l},{default:Vue.withCtx(()=>[Vue.createVNode(E,{label:"PT1",value:"PT1"}),Vue.createVNode(E,{label:"PT2",value:"PT2"}),Vue.createVNode(E,{label:"CT1",value:"CT1"}),Vue.createVNode(E,{label:"CT2",value:"CT2"})]),_:1},8,["modelValue"])]),Vue.createElementVNode("div",ke,[o[10]||(o[10]=Vue.createElementVNode("label",null,"*档位",-1)),Vue.createVNode(r,{modelValue:e.value.gearValue,"onUpdate:modelValue":o[1]||(o[1]=i=>e.value.gearValue=i),placeholder:"请输入档位数值",style:{width:"350px","margin-right":"10px"}},null,8,["modelValue"]),Vue.createVNode(g,{modelValue:e.value.gearUnit,"onUpdate:modelValue":o[2]||(o[2]=i=>e.value.gearUnit=i),placeholder:"档位单位",options:p.value,style:{width:"200px"}},null,8,["modelValue","options"])]),Vue.createElementVNode("div",xe,[o[11]||(o[11]=Vue.createElementVNode("label",null,"*百分比(%)",-1)),Vue.createVNode(r,{modelValue:e.value.percentage,"onUpdate:modelValue":o[3]||(o[3]=i=>e.value.percentage=i),placeholder:"请输入百分比"},null,8,["modelValue"])]),Vue.createElementVNode("div",$e,[o[12]||(o[12]=Vue.createElementVNode("label",null,"*数据下限(%)",-1)),Vue.createVNode(r,{modelValue:e.value.data_lower_limit,"onUpdate:modelValue":o[4]||(o[4]=i=>e.value.data_lower_limit=i),placeholder:"请输入数据下限"},null,8,["modelValue"])]),Vue.createElementVNode("div",he,[o[13]||(o[13]=Vue.createElementVNode("label",null,"*数据上限(%)",-1)),Vue.createVNode(r,{modelValue:e.value.data_upper_limit,"onUpdate:modelValue":o[5]||(o[5]=i=>e.value.data_upper_limit=i),placeholder:"请输入数据上限"},null,8,["modelValue"])]),Vue.createElementVNode("div",Te,[o[14]||(o[14]=Vue.createElementVNode("label",null,"*实测数据(%)",-1)),Vue.createVNode(r,{modelValue:e.value.measured_data,"onUpdate:modelValue":o[6]||(o[6]=i=>e.value.measured_data=i),placeholder:"请输入实测数据"},null,8,["modelValue"])])])]),Vue.createElementVNode("div",Ue,[Vue.createVNode(b,{type:"primary",onClick:f},{default:Vue.withCtx(()=>o[15]||(o[15]=[Vue.createTextVNode(" 保存 ")])),_:1}),Vue.createVNode(b,{onClick:u},{default:Vue.withCtx(()=>o[16]||(o[16]=[Vue.createTextVNode(" 重置 ")])),_:1})])])])):Vue.createCommentVNode("",!0)}}},je=k(De,[["__scopeId","data-v-4d1a78bd"]]),Se={class:"list-container"},Be={class:"upper-section"},Me={class:"device-info"},Pe={key:0},Ae={class:"search-filter"},ze={class:"action-buttons"},Fe={class:"lower-section"},Le=["onClick"],Re=["onClick"],Ke=["onClick"],qe={class:"pagination-wrapper"},Oe={__name:"ItemList",setup(a){const d=Vue.ref([]),v=Vue.ref(""),s=Vue.ref(1),c=Vue.ref(5),e=Vue.ref(0),p=Vue.ref([]),m=Vue.ref(!1),l=Vue.ref(!1),V=Vue.ref({}),f=Vue.ref(!1),u=Vue.ref({}),N=Vue.ref(!1),o=G(),E=H(),g=Vue.ref(o.query.deviceId||""),r=Vue.ref(o.params.taskId||""),b=Vue.ref(o.query.status||"未开始"),i=Vue.computed(()=>{const n=(s.value-1)*c.value,t=n+c.value;return d.value.slice(n,t)}),w=async()=>{try{const n=await T();r.value?d.value=n.filter(t=>t.task_id==r.value):d.value=n,e.value=d.value.length}catch(n){console.error("获取检测项目列表失败",n)}},y=()=>{if(b.value==="已完成"){ElementPlus.ElMessage.warning("实验已完成，不允许添加检测项目");return}l.value=!0},D=n=>{if(b.value==="已完成"){ElementPlus.ElMessage.warning("实验状态已完成，不允许修改检测项目信息");return}V.value={...n},f.value=!0},j=n=>{u.value={...n},N.value=!0},S=n=>{p.value=n,m.value=n.length>0&&n.length<d.value.length,n.length===d.value.length&&(m.value=!1)},B=n=>{n.length===d.value.length?m.value=!1:n.length>0?m.value=!0:m.value=!1,p.value=n},M=()=>!0,$=async()=>{try{const n=await T();r.value?d.value=n.filter(t=>t.task_id==r.value):d.value=n,d.value=d.value.filter(t=>t.project.includes(v.value)),e.value=d.value.length,s.value=1}catch(n){console.error("搜索检测项目信息失败",n)}},P=async()=>{try{const n=p.value.map(t=>t.item_id);for(const t of n)await U(t);await w()}catch(n){console.error("批量删除检测项目信息失败",n)}},A=async n=>{try{await U(n),await w()}catch(t){console.error("删除检测项目信息失败",t)}},z=n=>{ElementPlus.ElMessageBox.confirm("请问您是否要删除该检测项目信息?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{A(n.item_id)}).catch(()=>{})},F=n=>{c.value=n},L=n=>{s.value=n},R=()=>{E.push("/home/task-info")};return Vue.onMounted(()=>{w()}),(n,t)=>{const x=Vue.__unplugin_components_0,K=Vue.__unplugin_components_1,q=Vue.__unplugin_components_2,C=Vue.__unplugin_components_3,_=Vue.__unplugin_components_4,O=Vue.__unplugin_components_5,W=Vue.__unplugin_components_6;return Vue.openBlock(),Vue.createElementBlock("div",Se,[Vue.createVNode(K,{separator:"/",class:"breadcrumb"},{default:Vue.withCtx(()=>[Vue.createVNode(x,null,{default:Vue.withCtx(()=>t[4]||(t[4]=[Vue.createTextVNode("首页")])),_:1}),Vue.createVNode(x,null,{default:Vue.withCtx(()=>t[5]||(t[5]=[Vue.createTextVNode("实验任务管理")])),_:1}),Vue.createVNode(x,null,{default:Vue.withCtx(()=>t[6]||(t[6]=[Vue.createTextVNode("检测项目管理")])),_:1})]),_:1}),Vue.createElementVNode("div",Be,[Vue.createElementVNode("div",Me,[Vue.createElementVNode("span",null,"当前设备编号："+Vue.toDisplayString(g.value),1),t[7]||(t[7]=Vue.createElementVNode("br",null,null,-1)),r.value?(Vue.openBlock(),Vue.createElementBlock("span",Pe,"当前任务编号："+Vue.toDisplayString(r.value),1)):Vue.createCommentVNode("",!0)]),Vue.createElementVNode("div",Ae,[Vue.createVNode(q,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=I=>v.value=I),placeholder:"请输入项目名称",style:{width:"250px",margin:"10px 0"},onKeyup:Vue.withKeys($,["enter"])},null,8,["modelValue"]),Vue.createVNode(C,{type:"primary",onClick:$},{default:Vue.withCtx(()=>t[8]||(t[8]=[Vue.createTextVNode(" 搜索 ")])),_:1})]),Vue.createElementVNode("div",ze,[Vue.createVNode(C,{type:"danger",onClick:P},{default:Vue.withCtx(()=>t[9]||(t[9]=[Vue.createTextVNode(" 批量删除 ")])),_:1}),Vue.createVNode(C,{type:"warning",onClick:y},{default:Vue.withCtx(()=>t[10]||(t[10]=[Vue.createTextVNode(" 添加检测项目 ")])),_:1}),Vue.createVNode(C,{type:"primary",onClick:R},{default:Vue.withCtx(()=>t[11]||(t[11]=[Vue.createTextVNode(" 返回任务列表 ")])),_:1})])]),t[14]||(t[14]=Vue.createElementVNode("br",null,null,-1)),Vue.createElementVNode("div",Fe,[Vue.createVNode(O,{data:i.value,border:"",style:{width:"100%","margin-top":"20px"},"cell-style":{textAlign:"center"},"header-cell-style":{textAlign:"center"},onSelectionChange:S},{default:Vue.withCtx(()=>[Vue.createVNode(_,{type:"selection",width:"50",indeterminate:m.value,selectable:M,onSelectAll:B},null,8,["indeterminate"]),Vue.createVNode(_,{prop:"item_id",label:"检测项目ID",width:"120"}),Vue.createVNode(_,{prop:"project",label:"项目",width:"100"}),Vue.createVNode(_,{prop:"gear",label:"档位",width:"100"}),Vue.createVNode(_,{prop:"percentage",label:"百分比(%)",width:"120"}),Vue.createVNode(_,{prop:"data_lower_limit",label:"数据下限(%)",width:"150"}),Vue.createVNode(_,{prop:"data_upper_limit",label:"数据上限(%)",width:"150"}),Vue.createVNode(_,{prop:"measured_data",label:"实测数据(%)",width:"150"}),Vue.createVNode(_,{prop:"task_id",label:"关联任务ID",width:"120"}),Vue.createVNode(_,{label:"操作",fixed:"right","min-width":"200"},{default:Vue.withCtx(I=>[Vue.createElementVNode("a",{href:"javascript:void(0)",onClick:h=>D(I.row)},"编辑",8,Le),t[12]||(t[12]=Vue.createElementVNode("span",{class:"divider"},"|",-1)),Vue.createElementVNode("a",{href:"javascript:void(0)",onClick:h=>j(I.row)},"查看详情",8,Re),t[13]||(t[13]=Vue.createElementVNode("span",{class:"divider"},"|",-1)),Vue.createElementVNode("a",{href:"javascript:void(0)",onClick:h=>z(I.row)},"删除",8,Ke)]),_:1})]),_:1},8,["data"]),Vue.createElementVNode("div",qe,[Vue.createVNode(W,{"current-page":s.value,"page-sizes":[5,10,15],"page-size":c.value,layout:"total, prev, pager, next, sizes, jumper",total:e.value,onSizeChange:F,onCurrentChange:L},null,8,["current-page","page-size","total"])])]),Vue.createVNode(ie,{"item-info":V.value,"is-edit-visible":f.value,onClose:t[1]||(t[1]=I=>f.value=!1),onRefresh:w},null,8,["item-info","is-edit-visible"]),Vue.createVNode(be,{"item-info":u.value,"is-view-visible":N.value,onClose:t[2]||(t[2]=I=>N.value=!1)},null,8,["item-info","is-view-visible"]),Vue.createVNode(je,{"is-add-visible":l.value,"device-id":g.value,"task-id":r.value,onClose:t[3]||(t[3]=I=>l.value=!1),onRefresh:w},null,8,["is-add-visible","device-id","task-id"])])}}},Je=k(Oe,[["__scopeId","data-v-36739df2"]]);export{Je as default};
