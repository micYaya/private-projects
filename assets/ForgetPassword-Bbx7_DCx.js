import{u as _}from"./vue-core-C_l77I1y.js";import{r as y,a as C}from"./index-CgfAAbnT.js";import"vue";const N={class:"wrapper"},b={class:"reset-form"},B={__name:"ForgetPassword",setup(h){const p=_(),d=Vue.ref(null),t=Vue.ref({username:"",phone:"",verifyCode:"",password1:"",password2:""}),m={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:4,max:15,message:"用户名长度需在4到15个字符",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1\d{10}$/,message:"手机号格式不正确",trigger:"blur"}],verifyCode:[{required:!0,message:"请输入验证码",trigger:"blur"},{pattern:/^\d{4}$/,message:"验证码需为4位数字",trigger:"blur"}],password1:[{required:!0,message:"请输入密码",trigger:"blur"},{pattern:/^[A-Za-z\d]{6,10}$/,message:"密码需6-10位字母或数字",trigger:"blur"}],password2:[{required:!0,message:"请再次确定密码",trigger:"blur"},{validator:(o,e,r)=>{e!==t.value.password1?r(new Error("两次输入的密码不一致")):r()},trigger:"blur"}]},u=Vue.ref(60);let n=null;const c=Vue.computed(()=>/^1\d{10}$/.test(t.value.phone)),g=()=>{u.value=60,n=setInterval(()=>{u.value--,u.value<=0&&i()},1e3)},i=()=>{clearInterval(n),u.value=0,n=null};Vue.onBeforeUnmount(()=>{n&&i()});const v=async()=>{try{await d.value.validateField("phone"),g();const o=await C(t.value.phone);o.code!==0&&(ElementPlus.ElMessage.warning(o.msg),i())}catch(o){console.log("获取密码失败：",o)}},V=async()=>{try{if(!await d.value.validate())return;const{phone:e,verifyCode:r,password1:a}=t.value,s=await y(e,r,a);s.code===0?(await ElementPlus.ElMessageBox.alert("密码重置成功，将返回登录页面","成功",{type:"success",confirmButtonText:"确定"}),p.push("/login")):ElementPlus.ElMessage.warning(s.msg)}catch(o){console.error("密码重置失败:",o),ElementPlus.ElMessage.error("操作失败，请检查输入信息")}},w=()=>{p.push("/login")};return(o,e)=>{const r=Vue.__unplugin_components_0,a=Vue.__unplugin_components_1,s=Vue.__unplugin_components_2,f=Vue.__unplugin_components_3;return Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[e[8]||(e[8]=Vue.createElementVNode("div",{class:"header"},[Vue.createElementVNode("p",null,"互感器二次压降检测仪检定系统")],-1)),Vue.createElementVNode("div",N,[e[7]||(e[7]=Vue.createElementVNode("h1",null,"▎重置密码",-1)),Vue.createElementVNode("div",b,[Vue.createVNode(f,{ref_key:"FormRef",ref:d,model:t.value,rules:m,onSubmit:Vue.withModifiers(V,["prevent"])},{default:Vue.withCtx(()=>[Vue.createVNode(a,{label:"登录账号：",prop:"username"},{default:Vue.withCtx(()=>[Vue.createVNode(r,{modelValue:t.value.username,"onUpdate:modelValue":e[0]||(e[0]=l=>t.value.username=l),placeholder:"请输入账号"},null,8,["modelValue"])]),_:1}),Vue.createVNode(a,{label:"手机号码：",prop:"phone"},{default:Vue.withCtx(()=>[Vue.createVNode(r,{modelValue:t.value.phone,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.phone=l),placeholder:"请输入手机号码"},null,8,["modelValue"])]),_:1}),Vue.createVNode(a,{label:"验证码：",prop:"verifyCode"},{default:Vue.withCtx(()=>[Vue.createVNode(r,{modelValue:t.value.verifyCode,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.verifyCode=l),placeholder:"请输入验证码",style:{flex:"1"}},null,8,["modelValue"]),Vue.createVNode(s,{disabled:!c.value,type:"primary",style:{right:"0"},onClick:v},{default:Vue.withCtx(()=>[Vue.createTextVNode(Vue.toDisplayString(u.value<60?`${u.value}秒后重试`:"获取验证码"),1)]),_:1},8,["disabled"])]),_:1}),Vue.createVNode(a,{label:"新密码：",prop:"password1"},{default:Vue.withCtx(()=>[Vue.createVNode(r,{modelValue:t.value.password1,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.password1=l),type:"password","show-password":"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),Vue.createVNode(a,{label:"密码二次确认：",prop:"password2"},{default:Vue.withCtx(()=>[Vue.createVNode(r,{modelValue:t.value.password2,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.password2=l),type:"password","show-password":"",placeholder:"请再次确认密码"},null,8,["modelValue"])]),_:1}),Vue.createVNode(s,{type:"primary",class:"backBtn",onClick:w},{default:Vue.withCtx(()=>e[5]||(e[5]=[Vue.createTextVNode(" 返回登录页面 ")])),_:1}),Vue.createVNode(s,{type:"primary",class:"resetBtn",onClick:V},{default:Vue.withCtx(()=>e[6]||(e[6]=[Vue.createTextVNode(" 确定重置密码 ")])),_:1})]),_:1},8,["model"])])])],64)}}};export{B as default};
