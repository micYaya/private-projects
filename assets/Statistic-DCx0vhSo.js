import{u as x,c as b,i as k,d as D,e as C,g as B,h as M,k as R,l as j,m as z,n as y}from"./vue-core-DFw4SRCY.js";import{_ as O,g as Y,w as $,n as S,t as I,x as L}from"./index-CcVienhJ.js";const g={__name:"BaseChart",props:{option:Object,style:{type:Object,default:()=>({width:"100%",height:"400px"})}},setup(d){x([D,C,B,M,R,j,z]);const a=d,l=Vue.ref(null);let e=null;const i=()=>{l.value&&(e=k(l.value),a.option&&(a.option.responsive=!0,e.setOption(a.option)))},r=b(()=>{e&&e.resize()},300);return Vue.onMounted(()=>{i(),window.addEventListener("resize",r)}),Vue.watch(()=>a.option,n=>{e&&n&&(n.responsive=!0,e.setOption(n))},{deep:!0}),Vue.onBeforeUnmount(()=>{e&&(e.dispose(),e=null),window.removeEventListener("resize",r)}),(n,V)=>(Vue.openBlock(),Vue.createElementBlock("div",{ref_key:"chartRef",ref:l,style:Vue.normalizeStyle(d.style)},null,4))}},A={class:"statistic-page"},F={class:"statistic-card-container"},T={class:"count-label"},P={class:"count-number"},U={class:"chart-container"},q={class:"chart-item-shadow"},G={class:"chart-item-shadow"},H={class:"chart-item-shadow"},J={__name:"Statistic",setup(d){const a=Vue.ref({device:0,task:0,item:0,result:0}),l={device:"设备数量",task:"任务数量",item:"实验项目数量",result:"结果数量"},e=Vue.ref(0),i=Vue.ref([]),p=Vue.ref([]),r=Vue.ref({}),n=Vue.ref({}),V=Vue.ref({}),E=async()=>{try{const[c,s,u,m]=await Promise.all([Y(),$(),S(),I()]);a.value.device=c.length,a.value.task=s.length,a.value.item=u.length,a.value.result=m.length;const h=s.filter(t=>t.status==="已完成");e.value=h.length/c.length*100;const N=y().subtract(1,"month").format("YYYY-MM-DD"),w=await L(N),_={};w.forEach(t=>{const o=y(t.inspectionDate).format("YYYY-MM-DD");_[o]=(_[o]||0)+1}),i.value=Object.entries(_).map(([t,o])=>({date:t,count:o}));const f=new Map;u.forEach(t=>{f.set(t.project,(f.get(t.project)||0)+1)}),p.value=Array.from(f.entries()).map(([t,o])=>({value:o,name:t})),r.value={title:{text:"已完成任务设备占比",left:"center"},series:[{type:"pie",radius:["50%","70%"],label:{formatter:`${e.value.toFixed(1)}%`,fontSize:"3rem",position:"center"},data:[{value:e.value,name:"已完成任务设备"},{value:100-e.value,name:"未完成任务设备"}]}]},n.value={title:{text:"近一个月送检设备数量",left:"center"},xAxis:{data:i.value.map(t=>t.date)},yAxis:{},series:[{data:i.value.map(t=>t.count),type:"line"}],tooltip:{show:!0}},V.value={title:{text:"实验项目分类统计",left:"center"},series:[{type:"pie",data:p.value}],tooltip:{show:!0}}}catch(c){console.error("获取统计数据失败",c)}};return Vue.onMounted(()=>{E()}),(c,s)=>{const u=Vue.__unplugin_components_0,m=Vue.__unplugin_components_1;return Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Vue.createVNode(m,{separator:"/",class:"breadcrumb"},{default:Vue.withCtx(()=>[Vue.createVNode(u,null,{default:Vue.withCtx(()=>s[0]||(s[0]=[Vue.createTextVNode("首页")])),_:1}),Vue.createVNode(u,null,{default:Vue.withCtx(()=>s[1]||(s[1]=[Vue.createTextVNode("统计与分析")])),_:1})]),_:1}),Vue.createElementVNode("div",A,[Vue.createElementVNode("div",F,[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(a.value,(h,v)=>(Vue.openBlock(),Vue.createElementBlock("div",{key:v,class:"statistic-card"},[Vue.createElementVNode("span",T,Vue.toDisplayString(l[v]),1),Vue.createElementVNode("span",P,Vue.toDisplayString(h),1)]))),128))]),Vue.createElementVNode("div",U,[Vue.createElementVNode("div",q,[s[2]||(s[2]=Vue.createElementVNode("h3",{class:"chart-title"},"已完成任务设备占比",-1)),Vue.createVNode(g,{option:r.value},null,8,["option"])]),Vue.createElementVNode("div",G,[s[3]||(s[3]=Vue.createElementVNode("h3",{class:"chart-title"},"近一个月送检设备数量",-1)),Vue.createVNode(g,{option:n.value},null,8,["option"])]),Vue.createElementVNode("div",H,[s[4]||(s[4]=Vue.createElementVNode("h3",{class:"chart-title"},"实验项目分类统计",-1)),Vue.createVNode(g,{option:V.value},null,8,["option"])])])])],64)}}},W=O(J,[["__scopeId","data-v-a9a9dfdb"]]);export{W as default};
