import{u as x,c as B,e as C,f as I,h as U}from"./vue-core-C2r4m7CJ.js";import{ref as u,computed as T,createElementBlock as h,openBlock as F,Fragment as M,createElementVNode as d,createVNode as o,withModifiers as N,withCtx as a,createTextVNode as g,toDisplayString as S}from"vue";import{b as $,a as R}from"./index-DjiLuGwl.js";import{ElMessageBox as q,ElMessage as A}from"element-plus";const D={class:"wrapper"},L={class:"register-form"},J={__name:"Register",setup(P){const _=x(),V=u(""),r=u(""),i=u(""),c=u(""),l=u(60);let n;const y=T(()=>/^1\d{10}$/.test(r.value)),w=async()=>{if(console.log("开始计时"),l.value===60){console.log("启动倒计时"),l.value=60,n=setInterval(()=>{l.value--,console.log("time: ",l.value),l.value<=0&&(clearInterval(n),l.value=60)},1e3),console.log("开始问后端要验证码");const t=await R(r.value,"r");console.log(t),t.code===1&&(m(t.msg),l.value&&(l.value=60,clearInterval(n),n=null))}},m=t=>{A.error(t)},b=async()=>{if(!y.value){m("手机号不正确");return}if(!/^\d{4}$/.test(i.value)){m("验证码必须是4位数字");return}const t=await $(r.value,i.value,c.value);console.log(t),l.value&&(l.value=60,clearInterval(n),n=null),t.code===0?(await q.alert("注册成功，将返回系统登录界面","注册情况",{confirmButtonText:"确定",type:"success"}),_.push("/login")):m(t.msg)},E=()=>{_.push("/login")};return(t,e)=>{const p=I,v=C,f=U,k=B;return F(),h(M,null,[e[7]||(e[7]=d("div",{class:"header"},[d("p",null,"互感器二次压降检测仪检定系统")],-1)),d("div",D,[e[6]||(e[6]=d("h1",null,"▎账户注册",-1)),d("div",L,[o(k,{onSubmit:N(b,["prevent"])},{default:a(()=>[o(v,{label:"账户名称："},{default:a(()=>[o(p,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=s=>V.value=s),placeholder:"请输入账户名称"},null,8,["modelValue"])]),_:1}),o(v,{label:"手机号码："},{default:a(()=>[o(p,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=s=>r.value=s),placeholder:"请输入手机号码"},null,8,["modelValue"])]),_:1}),o(v,{label:"验证码："},{default:a(()=>[o(p,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=s=>i.value=s),placeholder:"请输入验证码",style:{flex:"1"}},null,8,["modelValue"]),o(f,{disabled:!y.value,type:"primary",style:{right:"0"},onClick:w},{default:a(()=>[g(S(l.value<60?`${l.value}秒后重试`:"获取验证码"),1)]),_:1},8,["disabled"])]),_:1}),o(v,{label:"密码："},{default:a(()=>[o(p,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=s=>c.value=s),type:"password","show-password":"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),o(f,{type:"primary",class:"backBtn",onClick:E},{default:a(()=>e[4]||(e[4]=[g(" 返回登录 ")])),_:1}),o(f,{type:"primary",class:"registerBtn",onClick:b},{default:a(()=>e[5]||(e[5]=[g(" 确定注册 ")])),_:1})]),_:1})])])],64)}}};export{J as default};
