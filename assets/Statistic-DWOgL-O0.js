import{O as S,P as B,Q as I,R as L,S as A,T,U as F,V as N,W as U,X as V,v as P,w as Q,Y as C}from"./vue-core-C2r4m7CJ.js";import{ref as o,onMounted as j,watch as W,onBeforeUnmount as X,createElementBlock as v,openBlock as h,normalizeStyle as q,Fragment as M,createVNode as r,createElementVNode as a,withCtx as R,createTextVNode as O,renderList as G,toDisplayString as Y}from"vue";import{_ as H,g as J,w as K,n as Z,t as tt,x as et}from"./index-DjiLuGwl.js";import"element-plus";const k={__name:"BaseChart",props:{option:Object,style:{type:Object,default:()=>({width:"100%",height:"400px"})}},setup(f){S([L,A,T,F,N,U,V]);const n=f,c=o(null);let t=null;const u=()=>{c.value&&(t=I(c.value),n.option&&(n.option.responsive=!0,t.setOption(n.option)))},p=B(()=>{t&&t.resize()},300);return j(()=>{u(),window.addEventListener("resize",p)}),W(()=>n.option,i=>{t&&i&&(i.responsive=!0,t.setOption(i))},{deep:!0}),X(()=>{t&&(t.dispose(),t=null),window.removeEventListener("resize",p)}),(i,g)=>(h(),v("div",{ref_key:"chartRef",ref:c,style:q(f.style)},null,4))}},st={class:"statistic-page"},at={class:"statistic-card-container"},nt={class:"count-label"},ot={class:"count-number"},it={class:"chart-container"},lt={class:"chart-item-shadow"},rt={class:"chart-item-shadow"},ct={class:"chart-item-shadow"},ut={__name:"Statistic",setup(f){const n=o({device:0,task:0,item:0,result:0}),c={device:"设备数量",task:"任务数量",item:"实验项目数量",result:"结果数量"},t=o(0),u=o([]),_=o([]),p=o({}),i=o({}),g=o({}),z=async()=>{try{const d=await J();n.value.device=d.length;const s=await K();n.value.task=s.length;const m=await Z();n.value.item=m.length;const w=await tt();n.value.result=w.length;const y=s.filter(e=>e.status==="已完成");t.value=y.length/d.length*100;const E=C().subtract(1,"month").format("YYYY-MM-DD"),$=await et(E),x={};$.forEach(e=>{const l=C(e.inspectionDate).format("YYYY-MM-DD");x[l]=(x[l]||0)+1}),u.value=Object.entries(x).map(([e,l])=>({date:e,count:l}));const D=new Map;m.forEach(e=>{D.set(e.project,(D.get(e.project)||0)+1)}),_.value=Array.from(D.entries()).map(([e,l])=>({value:l,name:e})),p.value={title:{text:"已完成任务设备占比",left:"center"},series:[{type:"pie",radius:["50%","70%"],label:{formatter:`${t.value.toFixed(1)}%`,fontSize:"3rem",position:"center"},data:[{value:t.value,name:"已完成任务设备"},{value:100-t.value,name:"未完成任务设备"}]}]},i.value={title:{text:"近一个月送检设备数量",left:"center"},xAxis:{data:u.value.map(e=>e.date)},yAxis:{},series:[{data:u.value.map(e=>e.count),type:"line"}],tooltip:{show:!0}},g.value={title:{text:"实验项目分类统计",left:"center"},series:[{type:"pie",data:_.value}],tooltip:{show:!0}}}catch(d){console.error("获取统计数据失败",d)}};return j(()=>{z()}),(d,s)=>{const m=Q,w=P;return h(),v(M,null,[r(w,{separator:"/",class:"breadcrumb"},{default:R(()=>[r(m,null,{default:R(()=>s[0]||(s[0]=[O("首页")])),_:1}),r(m,null,{default:R(()=>s[1]||(s[1]=[O("统计与分析")])),_:1})]),_:1}),a("div",st,[a("div",at,[(h(!0),v(M,null,G(n.value,(y,b)=>(h(),v("div",{key:b,class:"statistic-card"},[a("span",nt,Y(c[b]),1),a("span",ot,Y(y),1)]))),128))]),a("div",it,[a("div",lt,[s[2]||(s[2]=a("h3",{class:"chart-title"},"已完成任务设备占比",-1)),r(k,{option:p.value},null,8,["option"])]),a("div",rt,[s[3]||(s[3]=a("h3",{class:"chart-title"},"近一个月送检设备数量",-1)),r(k,{option:i.value},null,8,["option"])]),a("div",ct,[s[4]||(s[4]=a("h3",{class:"chart-title"},"实验项目分类统计",-1)),r(k,{option:g.value},null,8,["option"])])])])],64)}}},ht=H(ut,[["__scopeId","data-v-ee77d1c3"]]);export{ht as default};
