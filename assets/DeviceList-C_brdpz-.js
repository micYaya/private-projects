import{c as le,e as oe,f as q,L as ne,M as ie,N as ae,h as E,s as x,v as se,w as de,y as re,z as ue,A as ce}from"./vue-core-C5ihzaHo.js";import{ref as p,createBlock as ve,openBlock as h,withCtx as a,createVNode as l,createTextVNode as y,createElementBlock as M,createCommentVNode as z,withModifiers as A,createElementVNode as e,toDisplayString as D,withKeys as me}from"vue";import{_ as $,e as fe,c as pe,d as be,g as U,f as j}from"./index-BKSytqbL.js";import{ElMessage as S,ElMessageBox as ye}from"element-plus";const ge=(i,m,s)=>{if(m==null||m===""){s(new Error("ID不能为空"));return}const u=Number(m);if(isNaN(u)){s(new Error("ID必须是有效的数字"));return}if(!Number.isInteger(u)){s(new Error("ID必须是整数"));return}if(u<=0){s(new Error("ID必须是正整数"));return}s()},F={__name:"DeviceForm",props:{deviceInfo:{type:Object,default:()=>({})}},setup(i,{expose:m}){const s=p(null),u={deviceId:[{required:!0,message:"请输入设备ID",trigger:"blur"},{validator:ge,message:"设备ID必须是数字",trigger:"blur"}],deviceName:[{required:!0,message:"请输入设备名称",trigger:"blur"},{min:3,max:10,message:"设备名称长度必须在3到10之间",trigger:"blur"}],deviceModel:[{required:!0,message:"请输入设备型号",trigger:"blur"},{min:1,max:10,message:"设备型号长度必须在1到10之间",trigger:"blur"}],manufacturer:[{required:!0,message:"请输入制造商",trigger:"blur"},{min:3,max:15,message:"制造商长度必须在3到15之间",trigger:"blur"}],productionPlace:[{required:!0,message:"请输入产地",trigger:"blur"},{min:3,max:15,message:"产地长度必须在3到15之间",trigger:"blur"}]};return m({formRef:s}),(b,t)=>{const c=q,r=oe,v=ne,_=ae,k=ie,C=le;return h(),ve(C,{ref_key:"formRef",ref:s,model:i.deviceInfo,rules:u},{default:a(()=>[l(r,{label:"设备ID",prop:"deviceId"},{default:a(()=>[l(c,{modelValue:i.deviceInfo.deviceId,"onUpdate:modelValue":t[0]||(t[0]=f=>i.deviceInfo.deviceId=f),placeholder:"请输入设备ID"},null,8,["modelValue"])]),_:1}),l(r,{label:"设备名称",prop:"deviceName"},{default:a(()=>[l(c,{modelValue:i.deviceInfo.deviceName,"onUpdate:modelValue":t[1]||(t[1]=f=>i.deviceInfo.deviceName=f),placeholder:"请输入设备名称"},null,8,["modelValue"])]),_:1}),l(r,{label:"设备型号",prop:"deviceModel"},{default:a(()=>[l(c,{modelValue:i.deviceInfo.deviceModel,"onUpdate:modelValue":t[2]||(t[2]=f=>i.deviceInfo.deviceModel=f),placeholder:"请输入设备型号"},null,8,["modelValue"])]),_:1}),l(r,{label:"生产日期",prop:"manufactureDate"},{default:a(()=>[l(v,{modelValue:i.deviceInfo.manufactureDate,"onUpdate:modelValue":t[3]||(t[3]=f=>i.deviceInfo.manufactureDate=f),type:"datetime",placeholder:"请选择生产日期",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),l(r,{label:"送检日期",prop:"inspectionDate"},{default:a(()=>[l(v,{modelValue:i.deviceInfo.inspectionDate,"onUpdate:modelValue":t[4]||(t[4]=f=>i.deviceInfo.inspectionDate=f),type:"datetime",placeholder:"请选择送检日期",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),l(r,{label:"制造商",prop:"manufacturer"},{default:a(()=>[l(c,{modelValue:i.deviceInfo.manufacturer,"onUpdate:modelValue":t[5]||(t[5]=f=>i.deviceInfo.manufacturer=f),placeholder:"请输入制造商"},null,8,["modelValue"])]),_:1}),l(r,{label:"产地",prop:"productionPlace"},{default:a(()=>[l(c,{modelValue:i.deviceInfo.productionPlace,"onUpdate:modelValue":t[6]||(t[6]=f=>i.deviceInfo.productionPlace=f),placeholder:"请输入产地"},null,8,["modelValue"])]),_:1}),l(r,{label:"设备状态",prop:"deviceStatus"},{default:a(()=>[l(k,{modelValue:i.deviceInfo.deviceStatus,"onUpdate:modelValue":t[7]||(t[7]=f=>i.deviceInfo.deviceStatus=f)},{default:a(()=>[l(_,{label:"已检测"},{default:a(()=>t[8]||(t[8]=[y(" 已检测 ")])),_:1}),l(_,{label:"未检测"},{default:a(()=>t[9]||(t[9]=[y(" 未检测 ")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])}}},Ie={class:"modal"},De={class:"modal-content"},_e={class:"modal-footer"},we={__name:"EditDevice",props:{deviceInfo:{type:Object,default:()=>({})},isEditVisible:{type:Boolean,default:!1}},emits:["close","refresh"],setup(i,{emit:m}){const s=i,u=m,d=()=>{u("close")},b=p(null),t=async()=>{b.value.formRef.validate(async c=>{if(c){if(s.deviceInfo.id){s.deviceInfo.manufactureDate&&(s.deviceInfo.manufactureDate=x(s.deviceInfo.manufactureDate,"yyyy-MM-dd HH:mm:ss")),s.deviceInfo.inspectionDate&&(s.deviceInfo.inspectionDate=x(s.deviceInfo.inspectionDate,"yyyy-MM-dd HH:mm:ss"));try{await fe(s.deviceInfo),u("close"),u("refresh")}catch(r){console.error("编辑设备信息失败",r)}}}else return S.error("表单验证不通过，请检查输入信息"),!1})};return(c,r)=>{const v=E;return i.isEditVisible?(h(),M("div",{key:0,class:"modal-overlay",style:{"z-index":"99"},onClick:A(d,["self"])},[e("div",Ie,[e("div",{class:"modal-header"},[r[0]||(r[0]=e("span",null,"编辑设备信息",-1)),e("button",{onClick:d},"×")]),e("div",De,[l(F,{ref_key:"formRef",ref:b,"device-info":i.deviceInfo},null,8,["device-info"])]),e("div",_e,[l(v,{type:"primary",onClick:t},{default:a(()=>r[1]||(r[1]=[y(" 保存 ")])),_:1}),l(v,{onClick:d},{default:a(()=>r[2]||(r[2]=[y(" 取消 ")])),_:1})])])])):z("",!0)}}},Ve=$(we,[["__scopeId","data-v-7c9175bb"]]),xe={class:"modal"},Ce={class:"modal-content"},he={class:"form-item"},ke={class:"form-item"},Ee={class:"form-item"},Me={class:"form-item"},$e={class:"form-item"},Ne={class:"form-item"},Re={class:"form-item"},Be={class:"form-item"},Se={class:"modal-footer"},ze={__name:"ViewDevice",props:{deviceInfo:{type:Object,default:()=>({})},isViewVisible:{type:Boolean,default:!1}},emits:["close"],setup(i,{emit:m}){const s=m,u=()=>{s("close")},d=b=>b?x(new Date(b),"yyyy-MM-dd HH:mm:ss"):"";return(b,t)=>{const c=E;return i.isViewVisible?(h(),M("div",{key:0,class:"modal-overlay",style:{"z-index":"99"},onClick:A(u,["self"])},[e("div",xe,[e("div",{class:"modal-header"},[t[0]||(t[0]=e("span",null,"查看详情",-1)),e("button",{onClick:u},"×")]),e("div",Ce,[e("div",he,[t[1]||(t[1]=e("label",null,"设备ID:",-1)),e("span",null,D(i.deviceInfo.deviceId),1)]),e("div",ke,[t[2]||(t[2]=e("label",null,"设备名称:",-1)),e("span",null,D(i.deviceInfo.deviceName),1)]),e("div",Ee,[t[3]||(t[3]=e("label",null,"设备型号:",-1)),e("span",null,D(i.deviceInfo.deviceModel),1)]),e("div",Me,[t[4]||(t[4]=e("label",null,"制造商:",-1)),e("span",null,D(i.deviceInfo.manufacturer),1)]),e("div",$e,[t[5]||(t[5]=e("label",null,"产地:",-1)),e("span",null,D(i.deviceInfo.productionPlace),1)]),e("div",Ne,[t[6]||(t[6]=e("label",null,"生产日期:",-1)),e("span",null,D(d(i.deviceInfo.manufactureDate)),1)]),e("div",Re,[t[7]||(t[7]=e("label",null,"送检日期:",-1)),e("span",null,D(d(i.deviceInfo.inspectionDate)),1)]),e("div",Be,[t[8]||(t[8]=e("label",null,"设备状态:",-1)),e("span",null,D(i.deviceInfo.deviceStatus),1)])]),e("div",Se,[l(c,{onClick:u},{default:a(()=>t[9]||(t[9]=[y(" 关闭 ")])),_:1})])])])):z("",!0)}}},Ae=$(ze,[["__scopeId","data-v-477c83c5"]]),He={class:"modal"},Pe={class:"modal-content"},Ue={class:"modal-footer"},je={__name:"AddDevice",props:{isAddVisible:{type:Boolean,default:!1}},emits:["close","refresh"],setup(i,{emit:m}){const s=m,u=()=>{s("close")},d=p({deviceId:"",deviceName:"",deviceModel:"",manufactureDate:null,inspectionDate:null,manufacturer:"",productionPlace:"",deviceStatus:""}),b=p(null),t=async()=>{b.value.formRef.validate(async r=>{if(r){d.value.manufactureDate&&d.value.inspectionDate&&(d.value.manufactureDate=x(d.value.manufactureDate,"yyyy-MM-dd HH:mm:ss"),d.value.inspectionDate=x(d.value.inspectionDate,"yyyy-MM-dd HH:mm:ss"));try{const v=await pe(d.value.deviceId);if(console.log(v.exist),v.exist!==0){S.error("该设备编号已存在，请重新输入设备编号");return}await be(d.value),u(),s("refresh"),c()}catch(v){console.error("保存设备信息失败",v)}}else return S.error("表单验证不通过，请检查输入信息"),!1})},c=()=>{d.value={deviceId:"",deviceName:"",deviceModel:"",manufactureDate:null,inspectionDate:null,manufacturer:"",productionPlace:"",deviceStatus:""},b.value.formRef.resetFields()};return(r,v)=>{const _=E;return i.isAddVisible?(h(),M("div",{key:0,class:"modal-overlay",style:{"z-index":"99"},onClick:A(u,["self"])},[e("div",He,[e("div",{class:"modal-header"},[v[0]||(v[0]=e("span",null,"添加设备",-1)),e("button",{onClick:u},"×")]),e("div",Pe,[l(F,{ref_key:"formRef",ref:b,"device-info":d.value},null,8,["device-info"])]),e("div",Ue,[l(_,{type:"primary",onClick:t},{default:a(()=>v[1]||(v[1]=[y(" 保存 ")])),_:1}),l(_,{onClick:c},{default:a(()=>v[2]||(v[2]=[y(" 重置 ")])),_:1})])])])):z("",!0)}}},qe=$(je,[["__scopeId","data-v-da1111fc"]]),Fe={class:"list-container"},Le={class:"upper-section"},Te={class:"search-filter"},Ke={class:"action-buttons"},Oe={class:"lower-section"},Ge=["onClick"],Je=["onClick"],Qe=["onClick"],We={class:"pagination-wrapper"},Xe={__name:"DeviceList",setup(i){const m=p([]),s=p(""),u=p(1),d=p(5),b=p(0),t=p([]),c=p(!1),r=p(!1),v=p({}),_=p(!1),k=p({}),C=p(!1),f=o=>o?x(new Date(o),"yyyy-MM-dd"):"",w=async()=>{try{const o=await U();b.value=o.length;const n=(u.value-1)*d.value,V=n+d.value;m.value=o.slice(n,V)}catch(o){console.error("获取设备列表失败",o)}},L=()=>{r.value=!0},T=o=>{v.value={...o},_.value=!0,w()},K=o=>{k.value={...o},C.value=!0},O=o=>{t.value=o,c.value=o.length>0&&o.length<m.value.length,o.length===m.value.length&&(c.value=!1)},G=o=>{o.length===m.value.length?c.value=!1:o.length>0?c.value=!0:c.value=!1,t.value=o},J=()=>!0,H=async()=>{try{const n=(await U()).filter(R=>R.deviceName.includes(s.value));b.value=n.length,u.value=1;const V=0,N=d.value;m.value=n.slice(V,N)}catch(o){console.error("搜索设备信息失败",o)}},Q=async()=>{try{const o=t.value.map(n=>n.id);for(const n of o)await j(n);await w()}catch(o){console.error("批量删除设备信息失败",o)}},W=async o=>{try{await j(o),await w()}catch(n){console.error("删除设备信息失败",n)}},X=o=>{ye.confirm("请问您是否要删除该设备信息信息?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{W(o.id)}).catch(()=>{})},Y=o=>{console.log("新的每页数量:",o),d.value=o,w()},Z=o=>{console.log("新的页码:",o),u.value=o,w()};return w(),(o,n)=>{const V=de,N=se,R=q,B=E,I=ue,ee=re,te=ce;return h(),M("div",Fe,[l(N,{separator:"/",class:"breadcrumb"},{default:a(()=>[l(V,null,{default:a(()=>n[4]||(n[4]=[y("首页")])),_:1}),l(V,null,{default:a(()=>n[5]||(n[5]=[y("设备管理")])),_:1})]),_:1}),e("div",Le,[e("div",Te,[l(R,{modelValue:s.value,"onUpdate:modelValue":n[0]||(n[0]=g=>s.value=g),placeholder:"请输入设备名称",style:{width:"250px",margin:"10px 0"},onKeyup:me(H,["enter"])},null,8,["modelValue"]),l(B,{type:"primary",onClick:H},{default:a(()=>n[6]||(n[6]=[y(" 搜索 ")])),_:1})]),e("div",Ke,[l(B,{type:"danger",onClick:Q},{default:a(()=>n[7]||(n[7]=[y(" 批量删除 ")])),_:1}),l(B,{type:"warning",onClick:L},{default:a(()=>n[8]||(n[8]=[y(" 添加设备 ")])),_:1})])]),n[11]||(n[11]=e("br",null,null,-1)),e("div",Oe,[l(ee,{data:m.value,border:"",style:{width:"100%","margin-top":"20px"},"cell-style":{textAlign:"center"},"header-cell-style":{textAlign:"center"},onSelectionChange:O},{default:a(()=>[l(I,{type:"selection",width:"50",indeterminate:c.value,selectable:J,onSelectAll:G},null,8,["indeterminate"]),l(I,{prop:"deviceId",label:"设备ID",width:"100"}),l(I,{prop:"deviceName",label:"设备名称",width:"100"}),l(I,{prop:"deviceModel",label:"设备型号",width:"100"}),l(I,{prop:"manufactureDate",label:"生产日期",width:"200"},{default:a(g=>[y(D(f(g.row.manufactureDate)),1)]),_:1}),l(I,{prop:"inspectionDate",label:"送检日期",width:"200"},{default:a(g=>[y(D(f(g.row.inspectionDate)),1)]),_:1}),l(I,{prop:"manufacturer",label:"制造商",width:"140"}),l(I,{prop:"productionPlace",label:"产地",width:"140"}),l(I,{prop:"deviceStatus",label:"设备状态",width:"100"}),l(I,{label:"操作",fixed:"right","min-width":"200"},{default:a(g=>[e("a",{href:"javascript:void(0)",onClick:P=>T(g.row)},"编辑",8,Ge),n[9]||(n[9]=e("span",{class:"divider"},"|",-1)),e("a",{href:"javascript:void(0)",onClick:P=>K(g.row)},"查看详情",8,Je),n[10]||(n[10]=e("span",{class:"divider"},"|",-1)),e("a",{href:"javascript:void(0)",onClick:P=>X(g.row)},"删除",8,Qe)]),_:1})]),_:1},8,["data"]),e("div",We,[l(te,{"current-page":u.value,"page-sizes":[5,10,15],"page-size":d.value,layout:"total, prev, pager, next, sizes, jumper",total:b.value,onSizeChange:Y,onCurrentChange:Z},null,8,["current-page","page-size","total"])])]),l(Ve,{"device-info":v.value,"is-edit-visible":_.value,onClose:n[1]||(n[1]=g=>_.value=!1),onRefresh:w},null,8,["device-info","is-edit-visible"]),l(Ae,{"device-info":k.value,"is-view-visible":C.value,onClose:n[2]||(n[2]=g=>C.value=!1)},null,8,["device-info","is-view-visible"]),l(qe,{"is-add-visible":r.value,onClose:n[3]||(n[3]=g=>r.value=!1),onRefresh:w},null,8,["is-add-visible"])])}}},lt=$(Xe,[["__scopeId","data-v-6aeeb076"]]);export{lt as default};
