<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <button id="connect">连接</button>
    <button id="send" disabled="true">发送数据</button>
    <br>
    从服务端接受到的数据如下：<br>
    <span id="recv"></span>

    <script>
        let connect = document.getElementById('connect')
        let send = document.querySelector('#send')
        let recv = document.getElementById('recv')
        let ws = null
        connect.onclick = function(){
            ws = new WebSocket('ws://localhost:9998')
            ws.onopen = () => {
                console.log('连接服务端成功了...')
                send.disabled = false
            }
            ws.onclose = () => {
                console.log('连接服务端失败')
                send.disabled = true
            }
            // 接收数据事件
            ws.onmessage = msg => {
                console.log('接收到从服务端发送过来的数据')
                console.log(msg)
                // recv.innerHTML = msg.data

                // 这里的msg是Blob对象，主要用于浏览器环境，是JavaScript操作二进制数据的重要方式，常用于处理文件读取、网络请求返回数据等场景，比如在网页中实现文件上传下载功能，或者在前端进行图片、音频等媒体文件的处理等。
                if (msg.data instanceof Blob) {
                    const reader = new FileReader();
                    reader.onload = function() {
                        recv.innerHTML = reader.result;
                    };
                    reader.readAsText(msg.data);
                } else {
                    recv.innerHTML = msg.data;
                }
            }
            ws.onerror = (error) => {
                console.error('WebSocket连接发生错误:', error);
            }
            send.onclick = function () {
                // ws.send('hello socket from frontend')
                ws.send(JSON.stringify({
                    action: 'fullScreen',
                    socketType: 'fullScreen',
                    chartName: 'trend',
                    value: true
                }))
            }
        }
    </script>
</body>
</html>